<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurvivalQuant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            color: #333;
            margin: 0;
            padding: 10px;
        }

        /* 전체 컨테이너 */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* 1. 헤더 섹션 */
        .header-section {
            width: 100%;
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
        }

        /* 2. 링크 섹션 */
        .links-section {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        /* 링크 섹션 스타일 수정 */
        .quick-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-link {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            color: #4e54c8;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            gap: 6px;
        }

        .quick-link:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .quick-link img {
            width: 20px;
            height: 20px;
        }

        /* 3. 데이터 디스플레이 영역 */
        .data-display-section {
            width: 100%;
            display: flex;
            gap: 15px;
        }

        /* 3-1. 시계 영역 */
        .clock-section {
            flex: 0 0 auto;
            width: 200px;
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .clock-city-name {
            font-size: 1.2rem;
            color: #4e54c8;
            font-weight: 500;
        }

        .analog-clock-wrapper {
            width: 150px;
            height: 150px;
            position: relative;
        }

        .digital-clock {
            font-size: 1.1rem;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        /* 3-2. 코인 데이터 영역 */
        .coin-data-section {
            flex: 1;
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* IP 정보 스타일 */
        .ip-info {
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 10px;
        }

        .ip-label {
            font-weight: 500;
            color: #4e54c8;
            margin-right: 10px;
        }

        .ip-value {
            font-family: 'Courier New', monospace;
            color: #333;
        }

        /* 코인 테이블 헤더 스타일 */
        .coin-table-header {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 2px solid #e9ecef;
            font-weight: 500;
            color: #4e54c8;
            background: #f8f9fa;
            border-radius: 4px 4px 0 0;
            min-height: 40px;
        }

        .coin-table-header .coin-rank,
        .coin-table-header .coin-symbol,
        .coin-table-header .coin-price,
        .coin-table-header .coin-volume,
        .coin-table-header .coin-change {
            padding: 0 4px;
        }

        /* 기존 코인 아이템 스타일 수정 */
        .coin-rank {
            flex: 0 0 50px;
            text-align: center;
            white-space: nowrap;
        }

        .coin-symbol {
            flex: 0 0 120px;
            padding-left: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .coin-price {
            flex: 0 0 150px;
            text-align: right;
            white-space: nowrap;
        }

        .coin-volume {
            flex: 0 0 120px;
            text-align: right;
            white-space: nowrap;
        }

        .coin-change {
            flex: 0 0 100px;
            text-align: right;
            white-space: nowrap;
        }

        .coin-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            background: #ffffff;
            transition: background-color 0.2s;
            min-height: 40px;
            margin: 2px 0;
        }

        .coin-item:hover {
            background: #f8f9fa;
        }

        .coin-change.positive { color: #00b894; }
        .coin-change.negative { color: #ff7675; }

        /* 4. 광고 섹션 */
        .ad-container {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            padding: 15px;
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }

        .ad-placeholder {
            min-height: 250px;
            border: 1px dashed #e9ecef;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            text-align: center;
            color: #adb5bd;
        }

        .ad-size {
            font-size: 0.8rem;
            margin: 5px 0;
        }

        /* 날짜 정보 스타일 */
        .date-info {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
        }

        .solar-date,
        .lunar-date,
        .week-info,
        .day-info,
        .season-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .date-label {
            color: #4e54c8;
            font-weight: 500;
            min-width: 45px;
        }

        #solar-date,
        #lunar-date,
        #week-number,
        #day-name,
        #season-name {
            font-family: 'Courier New', monospace;
            color: #333;
        }

        @media (max-width: 768px) {
            .data-display-section {
                flex-direction: column;
            }
            
            .clock-section {
                width: 100%;
            }

            .coin-item {
                font-size: 0.9rem;
            }

            .coin-volume {
                display: none;
            }

            .coin-table-header .coin-volume {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- 1. 헤더 섹션 -->
        <div class="header-section">
            <h1>🚀 생존형 퀀트의 경제적 낙원</h1>
            <p>실시간 코인 차트 및 투자 도구</p>
        </div>

        <!-- 2. 링크 섹션 -->
        <div class="links-section">
            <div class="quick-links">
                <a href="https://www.bybit.com/copyMt5/trade-center/detail?providerMark=xkc2wsLqVomphpP%2FtV6RRQ%3D%3D" class="quick-link">
                    🏠 EconomicEden
                </a>
                <a href="https://blog.naver.com/economic_eden" class="quick-link">
                    📝 개발블로그
                </a>
                <a href="utilities.html" class="quick-link">
                    🛠️ 유틸리티
                </a>
                <a href="games/index.html" class="quick-link">
                    🎮 게임목록
                </a>
                <a href="https://www.youtube.com/@economiceden" class="quick-link">
                    📺 유튜브
                </a>
            </div>
        </div>

        <!-- 3. 데이터 디스플레이 영역 -->
        <div class="data-display-section">
            <!-- 3-1. 시계 영역 -->
            <div class="clock-section">
                <div class="clock-city-name">서울</div>
                <div class="analog-clock-wrapper">
                    <canvas id="analog-clock"></canvas>
                </div>
                <div class="digital-clock">
                    <span id="digital-time"></span>
                </div>
                <div class="date-info">
                    <div class="solar-date">
                        <span class="date-label">양력</span>
                        <span id="solar-date"></span>
                    </div>
                    <div class="lunar-date">
                        <span class="date-label">음력</span>
                        <span id="lunar-date"></span>
                    </div>
                    <div class="week-info">
                        <span class="date-label">주차</span>
                        <span id="week-number"></span>
                    </div>
                    <div class="day-info">
                        <span class="date-label">요일</span>
                        <span id="day-name"></span>
                    </div>
                    <div class="season-info">
                        <span class="date-label">절기</span>
                        <span id="season-name"></span>
                    </div>
                </div>
            </div>

            <!-- 3-2. 코인 데이터 영역 -->
            <div class="coin-data-section">
                <!-- IP 주소 표시 -->
                <div class="ip-info">
                    <span class="ip-label">접속 IP:</span>
                    <span id="ip-address" class="ip-value">확인 중...</span>
                </div>
                
                <!-- 코인 데이터 테이블 헤더 -->
                <div class="coin-table-header">
                    <span class="coin-rank">순위</span>
                    <span class="coin-symbol">코인명</span>
                    <span class="coin-price">현재가</span>
                    <span class="coin-volume">1시간 거래대금</span>
                    <span class="coin-change">등락률</span>
                </div>
                <div class="coin-list" id="top-coins">
                    <!-- 코인 데이터는 JavaScript로 동적 추가됨 -->
                </div>
            </div>
        </div>

        <!-- 4. 광고 섹션 -->
        <div class="ad-container">
            <div class="ad-placeholder">
                <p>프리미엄 광고</p>
                <p class="ad-size">300x600px</p>
            </div>
            <div class="ad-placeholder">
                <p>거래소 광고</p>
                <p class="ad-size">300x250px</p>
            </div>
            <div class="ad-placeholder">
                <p>코인 프로젝트</p>
                <p class="ad-size">300x250px</p>
            </div>
        </div>
    </div>

    <script>
        // IP 주소 확인
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('ip-address').textContent = data.ip;
            } catch (error) {
                document.getElementById('ip-address').textContent = '확인 불가';
                console.error('IP 주소 확인 실패:', error);
            }
        }

        // 시장 데이터 업데이트
        async function getMarketPrices() {
                const headers = {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
                };

                try {
                    // 코스피/코스닥 데이터
                    const indices = {
                        'kospi': 'https://api.finance.naver.com/service/itemSummary.naver?itemcode=KOSPI',
                        'kosdaq': 'https://api.finance.naver.com/service/itemSummary.naver?itemcode=KOSDAQ'
                    };

                    for (const [market, url] of Object.entries(indices)) {
                        try {
                            const response = await fetch(url, { headers });
                            const data = await response.json();
                            if (data) {
                                updateMarketData(market, data.now, data.changeRate);
                            }
                        } catch (error) {
                            console.error(`${market} 데이터 조회 실패:`, error);
                            // 임시 데이터로 표시
                            const tempData = getTempMarketData(market);
                            updateMarketData(market, tempData.price, tempData.change);
                        }
                    }

                    // 암호화폐 데이터 (업비트 API)
                    const cryptoSymbols = ['KRW-BTC', 'KRW-ETH'];
                    for (const symbol of cryptoSymbols) {
                    try {
                            const response = await fetch(`https://api.upbit.com/v1/ticker?markets=${symbol}`);
                            if (response.ok) {
                                const [data] = await response.json();
                                const id = symbol.split('-')[1].toLowerCase();
                                updateMarketData(id,
                                    data.trade_price,
                                    data.signed_change_rate * 100
                                );
                            }
                        } catch (error) {
                            console.error(`${symbol} 데이터 조회 실패:`, error);
                            const tempData = getTempMarketData(symbol.split('-')[1].toLowerCase());
                            updateMarketData(symbol.split('-')[1].toLowerCase(), tempData.price, tempData.change);
                        }
                    }

                    // USD/KRW 환율
                    try {
                        const usdResponse = await fetch('https://api.finance.naver.com/service/itemSummary.naver?itemcode=FX_USDKRW', { headers });
                        const usdData = await usdResponse.json();
                        if (usdData) {
                            updateMarketData('usdkrw', usdData.now, usdData.changeRate);
                        }
                    } catch (error) {
                        console.error('환율 데이터 조회 실패:', error);
                        const tempData = getTempMarketData('usdkrw');
                        updateMarketData('usdkrw', tempData.price, tempData.change);
                    }

                } catch (error) {
                    console.error('시장 데이터 조회 실패:', error);
                }
            }

        // 임시 시장 데이터 반환 (API 호출 실패시 사용)
        function getTempMarketData(symbol) {
            const tempData = {
                'kospi': { price: 2568.72, change: -0.5 },
                'kosdaq': { price: 842.65, change: -0.3 },
                'btc': { price: 65420000, change: 2.3 },
                'eth': { price: 3450000, change: 1.8 },
                'usdkrw': { price: 1315.50, change: -0.3 }
            };
            return tempData[symbol] || { price: 0, change: 0 };
    }

        // 시장 데이터 UI 업데이트
    function updateMarketData(symbol, price, change) {
            const priceElement = document.getElementById(`${symbol}_price`);
            const changeElement = document.getElementById(`${symbol}_change`);
        
        if (priceElement) {
                if (symbol === 'usdkrw') {
                    priceElement.textContent = price.toLocaleString('ko-KR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }) + ' 원';
                } else if (symbol === 'btc' || symbol === 'eth') {
                    priceElement.textContent = price.toLocaleString('ko-KR') + ' 원';
                } else {
                    priceElement.textContent = price.toLocaleString('ko-KR');
                }
        }
        
        if (changeElement) {
            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeElement.className = `market-change ${change >= 0 ? 'positive' : 'negative'}`;
        }
    }

        let upbitWebSocket = null;
        let marketCoins = new Map(); // 코인 정보 저장용 Map
        let tradeVolumes = new Map(); // 1시간 거래대금 저장용 Map
        let startPrices = new Map(); // 시작 가격 저장용 Map
        let firstTrades = new Map(); // 첫 거래 시간 저장용 Map

        // 웹소켓 연결 및 데이터 구독
        async function connectWebSocket() {
            try {
                // 1. 원화 마켓 코인 목록 가져오기
                const marketsResponse = await fetch('https://api.upbit.com/v1/market/all');
                const markets = await marketsResponse.json();
                const krwMarkets = markets.filter(market => market.market.startsWith('KRW-'));

                // 코인 정보 초기화
                krwMarkets.forEach(market => {
                    marketCoins.set(market.market, {
                        market: market.market,
                        korean_name: market.korean_name,
                        trade_price: 0,
                        acc_trade_price: 0,
                        change_rate: 0
                    });
                    tradeVolumes.set(market.market, 0);
                });

                // 2. 웹소켓 연결
                upbitWebSocket = new WebSocket('wss://api.upbit.com/websocket/v1');

                upbitWebSocket.onopen = () => {
                    console.log('웹소켓 연결됨');
                    const subscribeMsg = JSON.stringify([
                        { ticket: "UNIQUE_TICKET" },
                        {
                            type: "trade",
                            codes: krwMarkets.map(market => market.market)
                        }
                    ]);
                    upbitWebSocket.send(subscribeMsg);
                };

                upbitWebSocket.onclose = () => {
                    console.log('웹소켓 연결 끊김');
                    setTimeout(connectWebSocket, 3000);
                };

                upbitWebSocket.onerror = (error) => {
                    console.error('웹소켓 에러:', error);
                };

                upbitWebSocket.onmessage = (event) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        try {
                            const data = JSON.parse(reader.result);
                            handleTradeMessage(data);
                        } catch (error) {
                            console.error('메시지 파싱 에러:', error);
                        }
                    };
                    reader.readAsText(event.data);
                };

            } catch (error) {
                console.error('웹소켓 연결 실패:', error);
                setTimeout(connectWebSocket, 3000);
            }
        }

        // 거래 메시지 처리
        function handleTradeMessage(data) {
            if (!data || !data.code || data.type !== 'trade') return;

            const market = data.code;
            const tradePrice = data.trade_price * data.trade_volume;
            const currentTime = Date.now();
            
            // 첫 거래 시 시작가 기록
            if (!firstTrades.has(market)) {
                firstTrades.set(market, currentTime);
                startPrices.set(market, data.trade_price);
            }

            // 1시간이 지났는지 체크
            const oneHourAgo = currentTime - 3600000; // 1시간 = 3600000ms
            if (firstTrades.get(market) < oneHourAgo) {
                firstTrades.set(market, currentTime);
                startPrices.set(market, data.trade_price);
                tradeVolumes.set(market, 0);
            }

            // 거래대금 누적
            tradeVolumes.set(market, (tradeVolumes.get(market) || 0) + tradePrice);
            
            const coinInfo = marketCoins.get(market);
            if (coinInfo) {
                coinInfo.trade_price = data.trade_price;
                coinInfo.acc_trade_price = tradeVolumes.get(market);
                
                // 등락률 계산 (시작가 대비)
                const startPrice = startPrices.get(market);
                if (startPrice) {
                    coinInfo.change_rate = ((data.trade_price - startPrice) / startPrice) * 100;
                }
            }

            // 상위 10개 코인 업데이트
            updateTopCoins();
        }

        // 상위 10개 코인 정보 업데이트
        function updateTopCoins() {
            const topCoins = Array.from(marketCoins.values())
                .sort((a, b) => tradeVolumes.get(b.market) - tradeVolumes.get(a.market))
                .slice(0, 10);

            updateCoinList(topCoins);
        }

        // 코인 목록 UI 업데이트
        function updateCoinList(coinsData) {
            const coinListElement = document.getElementById('top-coins');
            if (!coinListElement) return;
            
            // 테이블 헤더 업데이트
            const headerElement = document.querySelector('.coin-table-header');
            if (headerElement) {
                headerElement.innerHTML = `
                    <span class="coin-rank">순위</span>
                    <span class="coin-symbol">코인명</span>
                    <span class="coin-price">현재가</span>
                    <span class="coin-volume">1시간 거래대금</span>
                    <span class="coin-change">등락률</span>
                `;
            }

            coinListElement.innerHTML = '';

            coinsData.forEach((coin, index) => {
                const coinElement = document.createElement('div');
                coinElement.className = 'coin-item';
                
                const tradeAmount = formatTradeAmount(tradeVolumes.get(coin.market));
                const changeClass = coin.change_rate >= 0 ? 'positive' : 'negative';
                const changeSign = coin.change_rate >= 0 ? '+' : '';
                const timePassed = firstTrades.has(coin.market) 
                    ? Math.floor((Date.now() - firstTrades.get(coin.market)) / 60000)
                    : 0;
                
                coinElement.innerHTML = `
                    <span class="coin-rank">${index + 1}</span>
                    <span class="coin-symbol">${coin.korean_name}</span>
                    <span class="coin-price">${formatNumber(coin.trade_price)} 원</span>
                    <span class="coin-volume">${tradeAmount}</span>
                    <span class="coin-change ${changeClass}">
                        ${changeSign}${coin.change_rate.toFixed(2)}%
                        <small>(${timePassed}분)</small>
                    </span>
                `;
                
                coinListElement.appendChild(coinElement);
            });
        }

        // 거래대금 포맷팅 함수
        function formatTradeAmount(amount) {
            if (amount >= 1000000000000) { // 1조 이상
                return `${(amount / 1000000000000).toFixed(1)}조`;
            } else if (amount >= 100000000) { // 1억 이상
                return `${(amount / 100000000).toFixed(1)}억`;
            } else if (amount >= 10000000) { // 1천만 이상
                return `${(amount / 10000000).toFixed(1)}천만`;
            } else {
                return `${(amount / 10000).toFixed(1)}만`;
            }
        }

        // 숫자 포맷팅 함수
        function formatNumber(num) {
            return num ? num.toLocaleString('ko-KR') : '0';
        }

        // 아날로그 시계 관련 코드
    const canvas = document.getElementById('analog-clock');
    const ctx = canvas.getContext('2d');
    
    function resizeClock() {
        const wrapper = canvas.parentElement;
            const size = Math.min(wrapper.clientWidth, wrapper.clientHeight);
        canvas.width = size;
        canvas.height = size;
            ctx.translate(size/2, size/2);
    }

    // 절기 정보
    const solarTerms = [
        { name: "소한", month: 1, day: 5 },
        { name: "대한", month: 1, day: 20 },
        { name: "입춘", month: 2, day: 4 },
        { name: "우수", month: 2, day: 19 },
        { name: "경칩", month: 3, day: 5 },
        { name: "춘분", month: 3, day: 20 },
        { name: "청명", month: 4, day: 5 },
        { name: "곡우", month: 4, day: 20 },
        { name: "입하", month: 5, day: 5 },
        { name: "소만", month: 5, day: 21 },
        { name: "망종", month: 6, day: 6 },
        { name: "하지", month: 6, day: 21 },
        { name: "소서", month: 7, day: 7 },
        { name: "대서", month: 7, day: 23 },
        { name: "입추", month: 8, day: 7 },
        { name: "처서", month: 8, day: 23 },
        { name: "백로", month: 9, day: 8 },
        { name: "추분", month: 9, day: 23 },
        { name: "한로", month: 10, day: 8 },
        { name: "상강", month: 10, day: 23 },
        { name: "입동", month: 11, day: 7 },
        { name: "소설", month: 11, day: 22 },
        { name: "대설", month: 12, day: 7 },
        { name: "동지", month: 12, day: 22 }
    ];

    // 날짜 정보 업데이트
    function updateDateInfo(seoulTime) {
        // 양력 날짜
        const solarDate = seoulTime.toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        });
        document.getElementById('solar-date').textContent = solarDate;

        // 음력 날짜 (Lunar Calendar API 필요)
        // 임시로 양력 날짜 표시
        document.getElementById('lunar-date').textContent = '음력 준비중';

        // 주차 정보
        const startOfYear = new Date(seoulTime.getFullYear(), 0, 1);
        const weekNumber = Math.ceil((((seoulTime - startOfYear) / 86400000) + startOfYear.getDay() + 1) / 7);
        document.getElementById('week-number').textContent = `${weekNumber}주차`;

        // 요일
        const dayName = seoulTime.toLocaleDateString('ko-KR', { weekday: 'long' });
        document.getElementById('day-name').textContent = dayName;

        // 절기
        const month = seoulTime.getMonth() + 1;
        const day = seoulTime.getDate();
        let currentSeason = "절기 외";

        for (const term of solarTerms) {
            if (term.month === month && Math.abs(term.day - day) <= 3) {
                currentSeason = term.name;
                break;
            }
        }
        document.getElementById('season-name').textContent = currentSeason;
    }

    function drawClock() {
            // 서울 시간 계산
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const seoulTime = new Date(utc + (9 * 3600000));

            // 디지털 시계 업데이트
            document.getElementById('digital-time').textContent = 
                seoulTime.toLocaleTimeString('ko-KR', { 
            hour12: false, 
            hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
        });

            // 날짜 정보 업데이트
            updateDateInfo(seoulTime);

            // 아날로그 시계 그리기
            const radius = canvas.width/2 * 0.90;
        ctx.save();
        ctx.clearRect(-canvas.width/2, -canvas.height/2, canvas.width, canvas.height);
        
            drawClockFace(radius);
            drawClockHands(radius, seoulTime);
        
        ctx.restore();
        requestAnimationFrame(drawClock);
    }

        function drawClockFace(radius) {
            // 시계 배경
        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, 2 * Math.PI);
            ctx.fillStyle = '#f8f9fa';
        ctx.fill();

            // 테두리
            ctx.lineWidth = radius * 0.05;
            ctx.strokeStyle = '#e9ecef';
        ctx.stroke();

            // 숫자
        ctx.font = radius * 0.15 + "px Segoe UI";
        ctx.textBaseline = "middle";
        ctx.textAlign = "center";
        ctx.fillStyle = "#333";
        
        for (let num = 1; num <= 12; num++) {
            const angle = (num * Math.PI / 6) - (Math.PI / 2);
            const x = radius * 0.85 * Math.cos(angle);
            const y = radius * 0.85 * Math.sin(angle);
            ctx.fillText(num.toString(), x, y);
        }

            // 중심점
            ctx.beginPath();
            ctx.arc(0, 0, radius * 0.03, 0, 2 * Math.PI);
            ctx.fillStyle = '#4e54c8';
            ctx.fill();
    }

        function drawClockHands(radius, time) {
            const hour = time.getHours() % 12;
            const minute = time.getMinutes();
            const second = time.getSeconds();
            const millisecond = time.getMilliseconds();

            // 시침
        const hourAngle = (hour * Math.PI / 6) +
            (minute * Math.PI / (6 * 60)) +
            (second * Math.PI / (360 * 60));
            drawHand(hourAngle, radius * 0.5, radius * 0.07, '#333');

            // 분침
            const minuteAngle = (minute * Math.PI / 30) + 
                (second * Math.PI / (30 * 60));
            drawHand(minuteAngle, radius * 0.8, radius * 0.05, '#555');

            // 초침
            const secondAngle = (second * Math.PI / 30) + 
                (millisecond * Math.PI / (30 * 1000));
            drawHand(secondAngle, radius * 0.9, radius * 0.02, '#4e54c8');
    }

        function drawHand(angle, length, width, color) {
        ctx.beginPath();
        ctx.lineWidth = width;
        ctx.lineCap = "round";
        ctx.strokeStyle = color;
        ctx.moveTo(0, 0);
        ctx.rotate(angle);
        ctx.lineTo(0, -length);
        ctx.stroke();
        ctx.rotate(-angle);
    }

        // 초기화 및 연결
        window.addEventListener('load', function() {
            resizeClock();
            drawClock();
            getIPAddress();  // IP 주소 확인
            connectWebSocket(); // 웹소켓 연결
            
            // 1분마다 데이터 업데이트
            setInterval(getUpbitMarketData, 60000);
            // 5분마다 IP 주소 갱신
            setInterval(getIPAddress, 300000);
        });

        // 페이지 언로드 시 웹소켓 연결 종료
        window.addEventListener('beforeunload', function() {
            if (upbitWebSocket) {
                upbitWebSocket.close();
            }
        });

        // 반응형 처리
        window.addEventListener('resize', resizeClock);

        // CSS 스타일 추가
        const style = document.createElement('style');
        style.textContent = `
            .coin-change small {
                font-size: 0.8em;
                color: #666;
                margin-left: 4px;
            }
            .coin-change.positive {
                color: #00b894;
            }
            .coin-change.negative {
                color: #ff7675;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>