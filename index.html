<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurvivalQuant</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ----------- 기존 스타일 유지, 일부만 개선 ----------- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        .section {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
        }
        .chart-section {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .control-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .control-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        .control-btn:hover {
            background: #e9ecef;
        }
        .control-btn.active:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        .coin-selector {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            background: white;
            font-size: 1rem;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
            min-width: 200px;
        }
        .coin-selector:hover { border-color: #667eea; transform: translateY(-2px);}
        .coin-selector:focus { outline: none; border-color: #667eea; box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);}
        .timeframe-legend {
            display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;
        }
        .legend-item { font-size: 0.9rem; font-weight: 600; padding: 5px 10px; border-radius: 15px; background: rgba(255,255,255,0.8);}
        .legend-item.daily { color: #222;}
        .legend-item.hourly4 { color: #FF5733;}
        .legend-item.minute30 { color: #2E7D32;}
        .legend-item.minute5 { color: #1976D2;}
        .legend-item.minute1 { color: #9C27B0;}
        .chart-info { margin-top: 20px; padding: 15px; background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6;}
        .info-item { margin-bottom: 8px; font-size: 0.9rem; color: #495057;}
        .info-item:last-child { margin-bottom: 0;}
        .fractal-chart-container {
            position: relative;
            height: 500px;
            width: 100%;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #6c757d;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
            overflow: hidden;
        }
        .candle-layer {
            position: absolute;
            top: 20px; left: 20px;
            width: calc(100% - 40px) !important;
            height: calc(100% - 40px) !important;
            pointer-events: none;
        }
        .loading {
            display: flex; justify-content: center; align-items: center;
            height: 200px; font-size: 1.1rem; color: #666;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .loading::after { content: '...'; animation: pulse 1.5s infinite; }
        .links-section { grid-column: 1; }
        .ads-section {
            background: #f8f9fa; min-height: 200px; border-style: dashed; display: flex; align-items: center; justify-content: center; color: #6c757d;
        }
        .future-section {
            background: #f1f3f4; min-height: 150px; border-style: dashed; display: flex; align-items: center; justify-content: center; color: #6c757d;
        }
        @media (min-width: 768px) {
            .main-container {
                grid-template-columns: 2fr 1fr;
                grid-template-areas:
                    "header header"
                    "chart chart"
                    "links ads"
                    "games utilities";
            }
            .header-section { grid-area: header; }
            .chart-section { grid-area: chart; }
            .links-section { grid-area: links; }
            .ads-section { grid-area: ads; }
            .games-section { grid-area: games; }
            .utilities-section { grid-area: utilities; }
        }
        h1 { font-size: 1.8rem; margin-bottom: 10px; font-weight: 400; }
        h2 { font-size: 1.8rem; margin-bottom: 20px; font-weight: 400; color: #333; }
        h3 { font-size: 1.3rem; margin-bottom: 10px; font-weight: 500; color: #555; }
        .url-display {
            background: #f8f9fa; color: #333; padding: 15px 20px; border-radius: 10px;
            font-size: 1.1rem; font-weight: 500; margin: 15px 0; word-break: break-all;
            border: 2px solid #e9ecef; transition: all 0.3s ease;
        }
        .url-display:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2);}
        .copy-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; border: none;
            padding: 12px 25px; border-radius: 25px; cursor: pointer;
            font-size: 1rem; font-weight: 500; transition: all 0.3s ease; margin-top: 15px;
        }
        .copy-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(238,90,36,0.4);}
        .success-message { display: none; color: #2ecc71; font-weight: 500; margin-top: 10px;}
        .link-display {
            background: #f8f9fa; color: #333; padding: 15px 20px; border-radius: 10px; margin: 15px 0;
            border: 2px solid #e9ecef; transition: all 0.3s ease;
        }
        .link-display a {
            color: #0066cc; text-decoration: none; font-size: 1.2rem; font-weight: 500; transition: color 0.3s ease;
        }
        .link-display a:hover { color: #004499; text-decoration: underline; }
        .section-link { display: block; text-decoration: none; color: inherit; transition: all 0.3s ease; position: relative; height: 100%; width: 100%;}
        .section-link:hover { transform: translateY(-2px); color: #333; }
        .link-arrow { position: absolute; bottom: 15px; right: 15px; font-size: 1.5rem; font-weight: bold; opacity: 0.7; transition: all 0.3s ease;}
        .section-link:hover .link-arrow { opacity: 1; transform: translateX(5px);}
    </style>
</head>
<body>
<div class="main-container">
    <!-- 헤더 섹션 -->
    <div class="section header-section">
        <h1>🚀 SurvivalQuant</h1>
        <p>EconomicEden - 실시간 코인 차트 및 투자 도구</p>
    </div>

    <!-- 프랙탈 캔들스틱 차트 섹션 -->
    <div class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">🕯️ 프랙탈 캔들스틱 차트</h2>
            <div class="chart-controls">
                <select id="coinSelector" class="coin-selector">
                    <option value="BTCUSDT">🟡 Bitcoin (BTC)</option>
                    <option value="ETHUSDT">🔷 Ethereum (ETH)</option>
                    <option value="SOLUSDT">🟣 Solana (SOL)</option>
                    <option value="ADAUSDT">🔵 Cardano (ADA)</option>
                    <option value="DOGEUSDT">🟠 Dogecoin (DOGE)</option>
                </select>
                <button class="control-btn active" id="refreshBtn" onclick="refreshChart()">🔄 새로고침</button>
            </div>
            <div class="timeframe-legend">
                <span class="legend-item daily">■ 1시간봉 (1H)</span>
                <span class="legend-item minute5">■ 5분봉 (5M)</span>
            </div>
        </div>
        <div class="fractal-chart-container" id="fractalContainer">
            <canvas id="hourlyCanvas" class="candle-layer" style="z-index: 1;"></canvas>
            <canvas id="minute5Canvas" class="candle-layer" style="z-index: 2;"></canvas>
            <div id="loadingMessage" class="loading">프랙탈 캔들 데이터 로딩중...</div>
        </div>
        <div class="chart-info">
            <div class="info-item"><strong>혁신적 컨셉:</strong> 프랙탈 구조 캔들스틱 차트 (1시간봉 + 5분봉)</div>
            <div class="info-item"><strong>구조:</strong> 1시간봉 → 5분봉(12개)</div>
            <div class="info-item"><strong>투명도:</strong> 1시간봉(30%) → 5분봉(불투명)</div>
        </div>
    </div>

    <!-- 링크 섹션 -->
    <div class="section links-section">
        <h2>🔗 주요 링크</h2>
        <div class="url-display" id="urlDisplay">
            https://dgpark0617.github.io/SurvivalQuant/
        </div>
        <button class="copy-btn" onclick="copyToClipboard()">
            📋 URL 복사하기
        </button>
        <div class="success-message" id="successMessage">
            ✅ URL이 클립보드에 복사되었습니다!
        </div>
        <div class="link-display">
            <a href="https://www.bybit.com/copyMt5/trade-center/detail?providerMark=xkc2wsLqVomphpP%2FtV6RRQ%3D%3D" target="_blank">
                🌟 EconomicEden
            </a>
        </div>
        <div class="link-display">
            <a href="https://m.blog.naver.com/economic_eden?tab=1" target="_blank">
                📖 개발블로그
            </a>
        </div>
        <div class="link-display">
            <a href="https://youtube.com/@economiceden?si=OLHH8h2MZep0oAYA" target="_blank">
                📺 유튜브
            </a>
        </div>
        <div class="link-display">
            <a href="https://cryptoinvest.cafe24.com:8080/m/dashboard" target="_blank">
                💰 크립토 대시보드
            </a>
        </div>
    </div>

    <!-- 광고 섹션 -->
    <div class="section ads-section">
        <div>
            <h3>📺 광고 공간</h3>
            <p>YouTube 애드센스 및 광고가 표시될 예정입니다</p>
        </div>
    </div>
    <!-- 게임 섹션 -->
    <div class="section future-section games-section">
        <a href="games/" class="section-link">
            <h3>🎮 미니 게임</h3>
            <p>재미있는 게임들을 즐겨보세요!</p>
            <div class="link-arrow">→</div>
        </a>
    </div>
    <!-- 유틸리티 섹션 -->
    <div class="section future-section utilities-section">
        <a href="utilities/" class="section-link">
            <h3>🛠️ 유틸리티</h3>
            <p>유용한 도구들을 사용해보세요!</p>
            <div class="link-arrow">→</div>
        </a>
    </div>
</div>
<script>
    // URL 복사
    function copyToClipboard() {
        const urlText = document.getElementById('urlDisplay').textContent;
        navigator.clipboard.writeText(urlText).then(function() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            setTimeout(() => { successMessage.style.display = 'none'; }, 3000);
        });
    }

    // 차트 관련 변수
    let currentSymbol = 'BTCUSDT';
    let candleData = { '1h': [], '5m': [] };
    let canvasContexts = {};
    let chartDimensions = { width: 0, height: 0 };

    // 캔버스 크기 동기화 (리사이즈 대응)
    function resizeCanvases() {
        const canvasIds = ['hourlyCanvas', 'minute5Canvas'];
        const container = document.getElementById('fractalContainer');
        const width = Math.max(300, container.clientWidth - 40);
        const height = Math.max(200, container.clientHeight - 40);
        canvasIds.forEach(canvasId => {
            const canvas = document.getElementById(canvasId);
            canvas.width = width;
            canvas.height = height;
            canvasContexts[canvasId] = canvas.getContext('2d');
        });
        chartDimensions.width = width;
        chartDimensions.height = height;
    }

    // 프랙탈 차트 초기화
    function initializeFractalChart() {
        resizeCanvases();
        document.getElementById('coinSelector').addEventListener('change', function(e) {
            currentSymbol = e.target.value;
            loadFractalCandleData();
        });
        window.addEventListener('resize', () => {
            resizeCanvases();
            drawFractalCandles();
        });
        loadFractalCandleData();
    }

    // 바이낸스 Kline 데이터 가져오기
    async function fetchKlineData(symbol, interval, limit) {
        try {
            const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
            if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            const data = await response.json();
            return data.map(kline => ({
                timestamp: parseInt(kline[0]),
                open: parseFloat(kline[1]),
                high: parseFloat(kline[2]),
                low: parseFloat(kline[3]),
                close: parseFloat(kline[4]),
                volume: parseFloat(kline[5])
            }));
        } catch (error) {
            console.error(`❌ ${symbol} ${interval} 데이터 가져오기 실패:`, error);
            return [];
        }
    }

    // 프랙탈 캔들 데이터 로드
    async function loadFractalCandleData() {
        document.getElementById('loadingMessage').style.display = 'flex';
        try {
            const requests = [
                fetchKlineData(currentSymbol, '1h', 24),   // 1시간봉 24개 (1일)
                fetchKlineData(currentSymbol, '5m', 288)   // 5분봉 288개 (1일)
            ];
            const [hourlyData, minute5Data] = await Promise.all(requests);
            candleData['1h'] = hourlyData;
            candleData['5m'] = minute5Data;
            drawFractalCandles();
            document.getElementById('loadingMessage').style.display = 'none';
        } catch (error) {
            document.getElementById('loadingMessage').innerHTML = `
                <div style="text-align: center; color: #ff4757;">
                    ❌ 프랙탈 캔들 데이터 로딩에 실패했습니다<br>
                    <small style="color: #666; font-size: 0.9rem;">에러: ${error.message}</small>
                </div>
            `;
        }
    }

    // 가격 범위 계산
    function calculatePriceRange() {
        let allPrices = [];
        Object.values(candleData).forEach(timeframeData =>
            timeframeData.forEach(candle => {
                allPrices.push(candle.high, candle.low);
            })
        );
        if (allPrices.length === 0) return { min: 0, max: 100 };
        const min = Math.min(...allPrices);
        const max = Math.max(...allPrices);
        const padding = (max - min) * 0.1;
        return { min: min - padding, max: max + padding };
    }

    // 각 타임프레임별 캔들 폭/간격 계산
    function getCandleRenderParams(timeframe) {
        const data = candleData[timeframe] || [];
        if (!data.length) return {candleWidth: 4, spacing: 2};
        const maxArea = chartDimensions.width * 0.90;
        const candleCount = data.length;
        let candleWidth = Math.max(3, Math.min(16, maxArea / (candleCount*1.5)));
        let spacing = Math.max(1, candleWidth * 0.3);
        return {candleWidth, spacing};
    }

    // 프랙탈 캔들 차트 그리기
    function drawFractalCandles() {
        Object.values(canvasContexts).forEach(ctx => ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height));
        const priceRange = calculatePriceRange();
        drawTimeframeCandles('1h', 'hourlyCanvas', priceRange, 0.30, '#222222');
        drawTimeframeCandles('5m', 'minute5Canvas', priceRange, 1.00, '#1976D2');
    }

    // 특정 시간대 캔들 그리기
    function drawTimeframeCandles(timeframe, canvasId, priceRange, opacity, color) {
        const ctx = canvasContexts[canvasId];
        const data = candleData[timeframe];
        if (!data || data.length === 0) return;
        const {candleWidth, spacing} = getCandleRenderParams(timeframe);
        const maxCandles = Math.floor(chartDimensions.width / (candleWidth + spacing));
        const recentData = data.slice(-maxCandles);
        const totalWidth = recentData.length * (candleWidth + spacing) - spacing;
        const startX = Math.max(0, (chartDimensions.width - totalWidth) / 2);

        recentData.forEach((candle, index) => {
            const x = startX + index * (candleWidth + spacing);
            drawSingleCandle(ctx, x, candle, candleWidth, priceRange, opacity, color);
        });
    }

    // 단일 캔들 그리기
    function drawSingleCandle(ctx, x, candle, width, priceRange, opacity, color) {
        const getY = (price) => {
            const ratio = (price - priceRange.min) / (priceRange.max - priceRange.min);
            return chartDimensions.height - (ratio * chartDimensions.height);
        };
        const openY = getY(candle.open), closeY = getY(candle.close), highY = getY(candle.high), lowY = getY(candle.low);
        const isUp = candle.close >= candle.open;
        const bodyColor = isUp ? "#4CAF50" : "#F44336";
        ctx.globalAlpha = opacity;

        // 캔들 몸통
        ctx.fillStyle = bodyColor;
        const bodyTop = Math.min(openY, closeY);
        const bodyHeight = Math.max(1, Math.abs(closeY - openY));
        if (bodyHeight > 1.2) {
            ctx.fillRect(x, bodyTop, width, bodyHeight);
        } else {
            ctx.strokeStyle = bodyColor;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x, openY);
            ctx.lineTo(x + width, openY);
            ctx.stroke();
        }

        // 꼬리 (wick)
        ctx.strokeStyle = color;
        ctx.lineWidth = Math.max(1, width / 6);
        ctx.beginPath();
        ctx.moveTo(x + width / 2, highY);
        ctx.lineTo(x + width / 2, lowY);
        ctx.stroke();

        ctx.globalAlpha = 1.0;
    }

    // 차트 새로고침
    function refreshChart() {
        loadFractalCandleData();
    }

    // 첫 렌더링
    document.addEventListener('DOMContentLoaded', function() {
        initializeFractalChart();
    });
</script>
</body>
</html>
