name: Prediction Automation

on:
  schedule:
    - cron: '30 */4 * * *'  # ë§¤ 4ì‹œê°„ 30ë¶„ ì „ì— ì‹¤í–‰
  issues:
    types: [closed]  # ì´ìŠˆê°€ ë‹«í ë•Œ

jobs:
  create-prediction:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Create Prediction Issue
        uses: actions/github-script@v6
        with:
          script: |
            const now = new Date();
            const nextFourHour = new Date(now.getTime() + 4 * 60 * 60 * 1000);
            
            const title = `[4H Poll] BTCUSDT ë°©í–¥ì„± ì˜ˆì¸¡ (${nextFourHour.toISOString().split('T')[0]} ${nextFourHour.getUTCHours()}:00)`;
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: `## ğŸ“Š 4ì‹œê°„ ë°©í–¥ì„± íˆ¬í‘œ\n\níˆ¬í‘œ ì§„í–‰ ì¤‘...\n\në§ˆê° ì‹œê°„: ${nextFourHour.toISOString()}`,
              labels: ['prediction', 'active']
            });

  update-stats:
    if: github.event_name == 'issues' && contains(github.event.issue.labels.*.name, 'prediction')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: ${{github.repository}}.wiki
          
      - name: Update Statistics
        uses: actions/github-script@v6
        with:
          script: |
            const issue = context.payload.issue;
            const reactions = await github.rest.reactions.listForIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸ ë¡œì§
            const stats = {
              upVotes: reactions.data.filter(r => r.content === '+1').length,
              downVotes: reactions.data.filter(r => r.content === '-1').length,
              totalVotes: reactions.data.length
            };
            
            // Wiki í˜ì´ì§€ ì—…ë°ì´íŠ¸
            // TODO: ì‹¤ì œ í†µê³„ ì—…ë°ì´íŠ¸ ë¡œì§ êµ¬í˜„ 