<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Binance BTC/USDT ì´ë™í‰ê·  ë° ì¶”ì„¸ (ì‚¬ìš©ì ì„ íƒ)</title>
  
  <!-- ======================================== -->
  <!-- ì‚¬ìš©ê¸°ê°„ ì„¤ì • - ì—¬ê¸°ì„œ ë§Œë£Œ ë‚ ì§œë¥¼ ìˆ˜ì •í•˜ì„¸ìš” -->
  <!-- ======================================== -->
  <!-- 
  ë§Œë£Œ ë‚ ì§œ í˜•ì‹: 'YYYY-MM-DDTHH:MM:SS'
  ì˜ˆì‹œ: '2025-07-30T23:59:59' (2025ë…„ 7ì›” 30ì¼ 23ì‹œ 59ë¶„ 59ì´ˆê¹Œì§€)
  
  í˜„ì¬ ì„¤ì •: 2025ë…„ 7ì›” 30ì¼ê¹Œì§€
  -->
  <script>
    // ì‚¬ìš©ê¸°ê°„ ì„¤ì • - ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”
    const EXPIRATION_DATE = '2025-07-30T23:59:59';
    const KAKAO_LINK = 'https://open.kakao.com/o/sy2UErbd';
    const MAIN_TITLE = 'ì‹œê·¸ë„ë©”ì´ì»¤: ì´ë™í‰ê·  êµì°¨ ì „ëµ';
    const SUB_TITLE = 'ì‹¤ì‹œê°„ ì´ë™í‰ê·  êµì°¨ë¡œ ë§¤ìˆ˜ íƒ€ì´ë°ì„ í¬ì°©í•˜ì„¸ìš”';
  </script>
  <style>
    /* ëª¨ë°”ì¼ ìš°ì„  ë””ìì¸ (ëª¨ë“  ë””ë°”ì´ìŠ¤ í†µìš©) */
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 18px;  /* ëª¨ë°”ì¼ ê¸°ì¤€ í¬ê¸° */
      max-width: 480px;  /* ëª¨ë°”ì¼ í™”ë©´ ë„ˆë¹„ ì œí•œ */
      margin: 0 auto;  /* ì¤‘ì•™ ì •ë ¬ */
      padding: 0;  /* ì—¬ë°± ì œê±° */
      background: #f5f6fa;
    }

    /* ê´‘ê³  í—¤ë” ì„¹ì…˜ */
    .ad-header {
      background: #1a1a1a;
      color: #fff;
      padding: 20px 0 12px 0;
      text-align: center;
      border-radius: 12px 12px 0 0;
      margin: 0;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .ad-header .main-title {
      font-size: clamp(1.1em, 2.5vw, 1.5em);
      font-weight: 600;
      margin-bottom: 10px;
    }

    .kakao-link {
      display: flex;
      align-items: center;
      gap: 0.3em;
      background: #fee500;
      color: #181600;
      border-radius: 6px;
      padding: 0.25em 0.7em 0.25em 0.5em;
      font-size: 0.98em;
      font-weight: 500;
      text-decoration: none;
      transition: background 0.2s;
      margin: 10px auto 0 auto;
      max-width: 260px;
    }

    .kakao-link:hover {
      background: #ffe066;
    }

    .kakao-icon {
      width: 1.3em;
      height: 1.3em;
      display: inline-block;
      vertical-align: middle;
    }

    .ad-header .sub-title {
      font-size: clamp(0.9em, 1.5vw, 1em);
      color: #cccccc;
      font-weight: normal;
      margin-top: 8px;
    }

    .usage-period {
      font-size: clamp(0.8em, 1vw, 0.9em);
      color: #ffffff;
      font-weight: 600;
      margin-top: 6px;
    }

    .update-time {
      font-size: clamp(0.8em, 1vw, 0.9em);
      color: #999;
      margin-top: 6px;
    }

    /* ë©”ì¸ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ */
    .main-content {
      background: #fff;
      border-radius: 0 0 12px 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    /* ì„¤ì • ìš”ì†Œ ì™„ì „í•œ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ */
    .setting-row select,
    .setting-row button {
      height: 32px !important;
      padding: 4px 8px !important;
      border: 1px solid #ccc !important;
      border-radius: 3px !important;
      box-sizing: border-box !important;
      margin: 0 !important;
      font-size: inherit !important;
      line-height: 1 !important;
      vertical-align: middle !important;
      display: inline-block !important;
    }

    .setting-row button {
      background: #007bff !important;
      color: white !important;
      cursor: pointer !important;
    }

    .setting-row select {
      background: white !important;
      color: #333 !important;
    }
    h1 { 
      font-size: 20px;  /* ëª¨ë°”ì¼ ê¸°ì¤€ ì œëª© í¬ê¸° */
      margin-bottom: 0.5em; 
    }
    #output div {
      line-height: 2em;  /* ëª¨ë°”ì¼ ê¸°ì¤€ ì¤„ ê°„ê²© */
      font-size: 18px;  /* ëª¨ë°”ì¼ ê¸°ì¤€ í…ìŠ¤íŠ¸ í¬ê¸° */
    }
    .label {
      display: inline-block;
      width: 35ch;  /* ëª¨ë°”ì¼ ê¸°ì¤€ ë„ˆë¹„ */
      font-weight: bold;
      font-size: 18px;  /* ëª¨ë°”ì¼ ê¸°ì¤€ í¬ê¸° */
    }
    .trend-up { color: #f44336; font-weight: bold; }
    .trend-down { color: #1976d2; font-weight: bold; }
    label, select {
      margin-right: 1em;
      font-size: 18px;  /* ëª¨ë°”ì¼ ê¸°ì¤€ í¬ê¸° */
      min-height: 44px;  /* í„°ì¹˜ ìµœì†Œ ë†’ì´ */
      padding: 8px;  /* í„°ì¹˜ ì˜ì—­ */
    }
  </style>
</head>
<body>
  <!-- ê´‘ê³  í—¤ë” ì„¹ì…˜ -->
      <div class="ad-header">
      <div class="main-title" id="main-title">BTC/USDT ì´ë™í‰ê·  ë§¤ìˆ˜ ì‹ í˜¸</div>
      <a class="kakao-link" id="kakao-link" href="https://open.kakao.com/o/sy2UErbd" target="_blank" rel="noopener noreferrer">
      <span class="kakao-icon">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="20" cy="20" r="20" fill="#FEE500"/>
          <path d="M20 10C13.9249 10 9 13.6863 9 18.1111C9 21.0192 11.2222 23.4956 14.4444 24.6667L13.3333 29.1111C13.2222 29.5556 13.6667 29.8889 14.0556 29.6667L19.1111 26.6667C19.3981 26.6842 19.6981 26.6944 20 26.6944C26.0751 26.6944 31 23.0081 31 18.5833C31 14.1585 26.0751 10 20 10Z" fill="#181600"/>
        </svg>
      </span>
      ìë™ë§¤ë§¤ ì œì‘ì˜ë¢°
    </a>
          <div class="sub-title" id="sub-title">ì‹¤ì‹œê°„ ì´ë™í‰ê·  êµì°¨ë¡œ ë§¤ìˆ˜ íƒ€ì´ë°ì„ í¬ì°©í•˜ì„¸ìš”</div>
    <div class="usage-period" id="usage-period">ì‚¬ìš©ê¸°ê°„ D-30 (2025-08-20ê¹Œì§€)</div>
    <div class="update-time" id="update-time"></div>
  </div>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div class="main-content">
    <h1>Binance BTC/USDT ì´ë™í‰ê·  ë° ì¶”ì„¸</h1>

    <div style="margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">âš™ï¸ ì„¤ì • ì •ë³´</div>
      <div style="border-bottom: 1px solid #ddd; margin-bottom: 8px;"></div>
      <div class="setting-row" style="display: flex; justify-content: space-between; margin-bottom: 3px;">
        <span>ë´‰ ê°„ê²©:</span>
        <span>
          <select id="timeframe-select">
            <option value="1m">1ë¶„</option>
            <option value="3m">3ë¶„</option>
            <option value="5m" selected>5ë¶„</option>
          </select>
        </span>
      </div>
      <div class="setting-row" style="display: flex; justify-content: space-between; margin-bottom: 3px;">
        <span>ë‹¨ê¸° ì´ë™í‰ê· :</span>
        <span>
          <select id="short-ma-select">
            <option value="3">3</option>
            <option value="5" selected>5</option>
            <option value="7">7</option>
          </select>
        </span>
      </div>
      <div class="setting-row" style="display: flex; justify-content: space-between; margin-bottom: 3px;">
        <span>ì¥ê¸° ì´ë™í‰ê· :</span>
        <span>
          <select id="long-ma-select">
            <option value="10">10</option>
            <option value="20" selected>20</option>
            <option value="30">30</option>
          </select>
        </span>
      </div>
      <div class="setting-row" style="display: flex; justify-content: space-between; margin-bottom: 3px;">
        <span>ì ìš©:</span>
        <span>
          <button id="apply-btn">ì ìš©</button>
        </span>
      </div>
    </div>

    <div id="output" style="margin-top:1em;"></div>
    <div id="trend" style="margin-top:0.5em;"></div>
    <div id="notification-status" style="margin-top:0.5em; font-size:0.9em; color:#666;"></div>
    <div id="chart-container" style="margin-top:1em; border: 1px solid #ddd; padding: 5px; background: #fff; width: 100%; max-width: 460px; overflow: hidden; box-sizing: border-box;">
      <canvas id="price-chart" style="width: 100%; height: auto; max-height: 300px; aspect-ratio: 1;"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ccxt@4.1.31/dist/ccxt.browser.js"></script>
  <script>
    function simpleMA(data, period) {
      if (data.length < period) return null;
      const slice = data.slice(data.length - period);
      const sum = slice.reduce((a, b) => a + b, 0);
      return sum / period;
    }

    function to2(num) {
      return num !== null ? num.toFixed(2) : 'ë°ì´í„° ë¶€ì¡±';
    }

    const binance = new ccxt.binance({ options: { defaultType: 'future' } });

    const outputDiv = document.getElementById('output');
    const trendDiv = document.getElementById('trend');
    const notificationStatusDiv = document.getElementById('notification-status');
    const chartCanvas = document.getElementById('price-chart');
    const timeframeSelect = document.getElementById('timeframe-select');
    const shortMASelect = document.getElementById('short-ma-select');
    const longMASelect = document.getElementById('long-ma-select');
    const applyBtn = document.getElementById('apply-btn');

    let autoRefreshInterval = null;
    let currentTimeframe = timeframeSelect.value;
    let currentShortMA = parseInt(shortMASelect.value);
    let currentLongMA = parseInt(longMASelect.value);
    let message_sent = 0; // ë§¤ìˆ˜ ì•Œë¦¼ ë°œì†¡ ìƒíƒœ ì¶”ì 

    // í™”ë©´ ì•Œë¦¼ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
    notificationStatusDiv.textContent = 'í™”ë©´ ì•Œë¦¼ ëª¨ë“œë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';

    // ëª¨ë°”ì¼ ìš°ì„  ë””ìì¸ - ê³ ì • í°íŠ¸ í¬ê¸°
    // ëª¨ë“  ë””ë°”ì´ìŠ¤ì—ì„œ ëª¨ë°”ì¼ í˜•íƒœ ìœ ì§€
    document.documentElement.style.fontSize = '18px';

    // ì‚¬ìš©ê¸°ê°„ ê´€ë¦¬ - ìƒë‹¨ì—ì„œ ì„¤ì •í•œ ê°’ ì‚¬ìš©
    const expireDate = new Date(EXPIRATION_DATE);
    
    function getExpireStatus() {
      const now = new Date();
      const diff = expireDate - now;
      if (diff < 0) return { expired: true, text: 'ì‚¬ìš©ê¸°ê°„ ë§Œë£Œ' };
      const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
      return { expired: false, text: `ì‚¬ìš©ê¸°ê°„ D-${days} (${expireDate.getFullYear()}-${String(expireDate.getMonth()+1).padStart(2,'0')}-${String(expireDate.getDate()).padStart(2,'0')}ê¹Œì§€)` };
    }

    // ë§Œë£Œ ìƒíƒœ í‘œì‹œ
    function showExpireStatus() {
      const status = getExpireStatus();
      const expireElem = document.getElementById('usage-period');
      if (expireElem) expireElem.textContent = status.text;
      if (status.expired) {
        document.body.innerHTML = `<div style="text-align:center; margin-top:100px; font-size:1.5em; color:#c00;">ì´ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.</div>`;
        throw new Error('ì„œë¹„ìŠ¤ ë§Œë£Œ');
      }
    }

    // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
    function updateTime() {
      const now = new Date();
      const timeStr = now.toLocaleString('ko-KR', { 
        year: 'numeric', 
        month: '2-digit', 
        day: '2-digit',
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit',
        hour12: false 
      });
      const updateElem = document.getElementById('update-time');
      if (updateElem) updateElem.textContent = `(${timeStr} ê¸°ì¤€)`;
    }

    // ìƒë‹¨ ì„¤ì •ê°’ ì ìš©
    function applyTopSettings() {
      const mainTitleElem = document.getElementById('main-title');
      const subTitleElem = document.getElementById('sub-title');
      const kakaoLinkElem = document.getElementById('kakao-link');
      
      if (mainTitleElem) mainTitleElem.textContent = MAIN_TITLE;
      if (subTitleElem) subTitleElem.textContent = SUB_TITLE;
      if (kakaoLinkElem) kakaoLinkElem.href = KAKAO_LINK;
    }

    // ì´ˆê¸° ì‹¤í–‰
    applyTopSettings();
    showExpireStatus();
    updateTime();
    setInterval(updateTime, 1000); // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸

    // ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜
    function drawChart(ohlcv, shortMA, longMA) {
      const ctx = chartCanvas.getContext('2d');
      
      // ëª¨ë°”ì¼ ê¸°ì¤€ ì°¨íŠ¸ í¬ê¸° (ê³ ì •)
      const container = document.getElementById('chart-container');
      const availableWidth = Math.min(460, container.clientWidth - 10); // ëª¨ë°”ì¼ ê¸°ì¤€ ìµœëŒ€ ë„ˆë¹„
      const containerHeight = availableWidth; // ì •ì‚¬ê°í˜• ìœ ì§€
      
      // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
      chartCanvas.width = availableWidth;
      chartCanvas.height = containerHeight;
      
      const width = chartCanvas.width;
      const height = chartCanvas.height;
      
      // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
      ctx.clearRect(0, 0, width, height);
      
      if (ohlcv.length === 0) return;
      
      // ë°ì´í„° ë²”ìœ„ ê³„ì‚°
      const prices = ohlcv.flatMap(candle => [candle[2], candle[3], candle[4]]); // high, low, close
      const minPrice = Math.min(...prices);
      const maxPrice = Math.max(...prices);
      const priceRange = maxPrice - minPrice;
      
      // ì°¨íŠ¸ ì˜ì—­ ì„¤ì • (ì •ì‚¬ê°í˜• ìµœì í™”)
      const padding = Math.max(30, Math.min(50, width * 0.12)); // ì •ì‚¬ê°í˜•ì— ë§ëŠ” íŒ¨ë”©
      const chartWidth = width - 2 * padding;
      const chartHeight = height - 2 * padding;
      
      // ìº”ë“¤ ìˆ˜ ì œí•œ (ëª¨ë°”ì¼ ìµœì í™”)
      const maxCandles = Math.min(ohlcv.length, Math.floor(chartWidth / 8)); // ìµœì†Œ 8px ìº”ë“¤ ë„ˆë¹„ ë³´ì¥
      const displayCandles = ohlcv.slice(-maxCandles); // ìµœê·¼ ìº”ë“¤ë§Œ í‘œì‹œ
      const candleWidth = chartWidth / maxCandles;
      
      // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
      ctx.strokeStyle = '#f0f0f0';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding + (chartHeight / 4) * i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
      }
      
      // ìº”ë“¤ ê·¸ë¦¬ê¸° (ì œí•œëœ ìˆ˜)
      displayCandles.forEach((candle, index) => {
        const [timestamp, open, high, low, close] = candle;
        const x = padding + index * candleWidth + candleWidth / 2;
        
        // ìº”ë“¤ ìƒ‰ìƒ (ìƒìŠ¹: ë¹¨ê°•, í•˜ë½: íŒŒë‘)
        const isUp = close >= open;
        ctx.fillStyle = isUp ? '#f44336' : '#1976d2';
        ctx.strokeStyle = isUp ? '#d32f2f' : '#1565c0';
        
        // ìº”ë“¤ ëª¸í†µ (ë°˜ì‘í˜• í¬ê¸°)
        const openY = padding + chartHeight - ((open - minPrice) / priceRange) * chartHeight;
        const closeY = padding + chartHeight - ((close - minPrice) / priceRange) * chartHeight;
        const bodyHeight = Math.max(1, Math.abs(closeY - openY)); // ìµœì†Œ ë†’ì´ ë³´ì¥
        const bodyY = Math.min(openY, closeY);
        const bodyWidth = Math.max(1, candleWidth * 0.6); // ìº”ë“¤ ëª¸í†µ ë„ˆë¹„
        
        ctx.fillRect(x - bodyWidth/2, bodyY, bodyWidth, bodyHeight);
        ctx.strokeRect(x - bodyWidth/2, bodyY, bodyWidth, bodyHeight);
        
        // ì‹¬ì§€ (wick) - ë°˜ì‘í˜• ë‘ê»˜
        const highY = padding + chartHeight - ((high - minPrice) / priceRange) * chartHeight;
        const lowY = padding + chartHeight - ((low - minPrice) / priceRange) * chartHeight;
        const wickWidth = Math.max(1, candleWidth * 0.1); // ì‹¬ì§€ ë‘ê»˜
        
        ctx.lineWidth = wickWidth;
        ctx.beginPath();
        ctx.moveTo(x, highY);
        ctx.lineTo(x, lowY);
        ctx.stroke();
        ctx.lineWidth = 1; // ê¸°ë³¸ ë‘ê»˜ë¡œ ë³µì›
      });
      
      // ì´ë™í‰ê· ì„  ê·¸ë¦¬ê¸° (í•´ì™¸ í‘œì¤€ ìƒ‰ìƒ)
      if (shortMA && shortMA.length > 0) {
        ctx.strokeStyle = '#FF0000'; // ë¹¨ê°• (ë‹¨ê¸°)
        ctx.lineWidth = 2;
        ctx.beginPath();
        const shortMADisplay = shortMA.slice(-maxCandles);
        shortMADisplay.forEach((value, index) => {
          if (value !== null) {
            const x = padding + index * candleWidth + candleWidth / 2;
            const y = padding + chartHeight - ((value - minPrice) / priceRange) * chartHeight;
            if (index === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
        });
        ctx.stroke();
      }
      
      if (longMA && longMA.length > 0) {
        ctx.strokeStyle = '#0000FF'; // íŒŒë‘ (ì¥ê¸°)
        ctx.lineWidth = 2;
        ctx.beginPath();
        const longMADisplay = longMA.slice(-maxCandles);
        longMADisplay.forEach((value, index) => {
          if (value !== null) {
            const x = padding + index * candleWidth + candleWidth / 2;
            const y = padding + chartHeight - ((value - minPrice) / priceRange) * chartHeight;
            if (index === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
        });
        ctx.stroke();
      }
      
      // ë²”ë¡€ ê·¸ë¦¬ê¸° (í„°ì¹˜ ì¹œí™”ì  í¬ê¸°)
      ctx.fillStyle = '#333';
      const chartFontSize = Math.max(16, Math.min(20, width * 0.035)); // ì°¨íŠ¸ìš© í°íŠ¸ í¬ê¸° ë” ì¦ê°€
      ctx.font = `${chartFontSize}px monospace`;
      ctx.fillText('ë‹¨ê¸°MA (ë¹¨ê°•)', 10, chartFontSize + 5);
      ctx.fillText('ì¥ê¸°MA (íŒŒë‘)', 10, chartFontSize * 2 + 5);
    }

    async function fetchAndShow(timeframe, shortMA, longMA) {
      try {
        const ohlcv = await binance.fetchOHLCV('BTC/USDT', timeframe, undefined, 100);
        const closes = ohlcv.map(x => x[4]);

        // ì´ë™í‰ê·  ê³„ì‚° (ì „ì²´ ê¸°ê°„)
        const shortMAValues = [];
        const longMAValues = [];
        
        for (let i = 0; i < closes.length; i++) {
          if (i >= shortMA - 1) {
            const shortSlice = closes.slice(i - shortMA + 1, i + 1);
            shortMAValues.push(simpleMA(shortSlice, shortMA));
          } else {
            shortMAValues.push(null);
          }
          
          if (i >= longMA - 1) {
            const longSlice = closes.slice(i - longMA + 1, i + 1);
            longMAValues.push(simpleMA(longSlice, longMA));
          } else {
            longMAValues.push(null);
          }
        }

        const maShort = simpleMA(closes, shortMA);
        const maLong = simpleMA(closes, longMA);

        const latest = ohlcv[ohlcv.length - 1];
        const [ts, open, high, low, close, volume] = latest;
        const barTime = new Date(ts).toLocaleString();
        const nowStr = new Date().toLocaleTimeString();

        outputDiv.innerHTML = `
          <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 5px;">â° ì‹œê°„ ì •ë³´</div>
            <div style="border-bottom: 1px solid #ddd; margin-bottom: 8px;"></div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>ë°ì´í„° ì‹œê°„:</span>
              <span>${barTime}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>í˜„ì¬ ì‹œê°„:</span>
              <span>${nowStr}</span>
            </div>
          </div>

          <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’° ê°€ê²© ì •ë³´</div>
            <div style="border-bottom: 1px solid #ddd; margin-bottom: 8px;"></div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>í˜„ì¬ ê°€ê²©:</span>
              <span>${to2(close)}</span>
            </div>
          </div>

          <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“ˆ ì§€í‘œ ì •ë³´</div>
            <div style="border-bottom: 1px solid #ddd; margin-bottom: 8px;"></div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>ë‹¨ê¸° ì´ë™í‰ê· (${shortMA}):</span>
              <span>${to2(maShort)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>ì¥ê¸° ì´ë™í‰ê· (${longMA}):</span>
              <span>${to2(maLong)}</span>
            </div>
          </div>

          <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ¯ ì¡°ê±´ ì •ë³´</div>
            <div style="border-bottom: 1px solid #ddd; margin-bottom: 8px;"></div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>ì¶”ì„¸:</span>
              <span id="trend-status">ê³„ì‚° ì¤‘...</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
              <span>ë§¤ìˆ˜ ì¡°ê±´:</span>
              <span id="buy-condition">ê³„ì‚° ì¤‘...</span>
            </div>
          </div>
        `;

        // ì¡°ê±´ ì •ë³´ ì—…ë°ì´íŠ¸
        const trendStatusElem = document.getElementById('trend-status');
        const buyConditionElem = document.getElementById('buy-condition');
        
        if (maShort !== null && maLong !== null) {
          if (maShort > maLong) {
            if (trendStatusElem) trendStatusElem.innerHTML = '<span style="color: #28a745; font-weight: bold;">ìƒìŠ¹</span>';
            
            // ìƒìŠ¹ ìƒíƒœì—ì„œ ì¢…ê°€ê°€ ë‹¨ê¸°ì´ë™í‰ê· ì„ ë³´ë‹¤ ë†’ê³ , ì•„ì§ ì•Œë¦¼ì„ ë³´ë‚´ì§€ ì•Šì•˜ë‹¤ë©´
            if (close > maShort && message_sent === 0) {
              // í™”ë©´ ì•Œë¦¼ ë°œì†¡
              message_sent = 1;
              notificationStatusDiv.innerHTML = '<span style="color: #f44336; font-weight: bold; font-size: 1.2em;">ğŸš¨ ë§¤ìˆ˜ ì‹ í˜¸! ğŸš¨</span><br>í˜„ì¬ê°€: ' + to2(close) + ' | ë‹¨ê¸°MA: ' + to2(maShort) + ' | ì¥ê¸°MA: ' + to2(maLong);
              
              // í™”ë©´ ê¹œë¹¡ì„ íš¨ê³¼
              document.body.style.backgroundColor = '#fff3cd';
              setTimeout(() => {
                document.body.style.backgroundColor = '#f8f9fa';
              }, 1000);
            }
            
            // ë§¤ìˆ˜ ì¡°ê±´ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (buyConditionElem) {
              if (close > maShort) {
                buyConditionElem.innerHTML = '<span style="color: #28a745; font-weight: bold;">í˜„ì¬ê°€ > ë‹¨ê¸°MA (ì¡°ê±´ ë§Œì¡±)</span>';
              } else {
                buyConditionElem.innerHTML = '<span style="color: #ffc107; font-weight: bold;">í˜„ì¬ê°€ â‰¤ ë‹¨ê¸°MA (ì¡°ê±´ ëŒ€ê¸°)</span>';
              }
            }
          } else if (maShort < maLong) {
            if (trendStatusElem) trendStatusElem.innerHTML = '<span style="color: #dc3545; font-weight: bold;">í•˜ë½</span>';
            message_sent = 0; // í•˜ë½ ìƒíƒœê°€ ë˜ë©´ ì•Œë¦¼ ìƒíƒœ ë¦¬ì…‹
            notificationStatusDiv.textContent = 'ì•Œë¦¼ ìƒíƒœ ë¦¬ì…‹ë¨ - ë‹¤ìŒ ë§¤ìˆ˜ ê¸°íšŒ ëŒ€ê¸° ì¤‘';
            
            // ë§¤ìˆ˜ ì¡°ê±´ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (buyConditionElem) {
              buyConditionElem.innerHTML = '<span style="color: #6c757d; font-weight: bold;">í•˜ë½ ì¶”ì„¸ (ë§¤ìˆ˜ ëŒ€ê¸°)</span>';
            }
          } else {
            if (trendStatusElem) trendStatusElem.innerHTML = '<span style="color: #6c757d; font-weight: bold;">ë™ì¼</span>';
            if (buyConditionElem) {
              buyConditionElem.innerHTML = '<span style="color: #6c757d; font-weight: bold;">ì¶”ì„¸ ë¶ˆëª…í™•</span>';
            }
          }
        } else {
          if (trendStatusElem) trendStatusElem.textContent = 'ê³„ì‚° ì¤‘...';
          if (buyConditionElem) buyConditionElem.textContent = 'ê³„ì‚° ì¤‘...';
          notificationStatusDiv.textContent = '';
        }
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        drawChart(ohlcv, shortMAValues, longMAValues);
        
        // ëª¨ë°”ì¼ ìš°ì„  ë””ìì¸ - ì°¨íŠ¸ í¬ê¸° ê³ ì •
        // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œì—ë„ ëª¨ë°”ì¼ í˜•íƒœ ìœ ì§€
        
      } catch (e) {
        outputDiv.textContent = 'ì˜¤ë¥˜: ' + e.message;
        trendDiv.textContent = '';
        notificationStatusDiv.textContent = '';
      }
    }

    applyBtn.addEventListener('click', () => {
      currentTimeframe = timeframeSelect.value;
      currentShortMA = parseInt(shortMASelect.value);
      currentLongMA = parseInt(longMASelect.value);

      fetchAndShow(currentTimeframe, currentShortMA, currentLongMA);

      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
      }
      autoRefreshInterval = setInterval(() => {
        fetchAndShow(currentTimeframe, currentShortMA, currentLongMA);
      }, 3000);
    });
  </script>
</body>
</html>