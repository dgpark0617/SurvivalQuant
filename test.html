<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurvivalQuant Tests</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #181a20;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-suite {
            background: #23262f;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-case {
            background: #2a2d35;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .test-result {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .pass { color: #4caf50; }
        .fail { color: #f44336; }
        .pending { color: #ff9800; }
        .error-details {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }
        .test-summary {
            margin-top: 20px;
            padding: 15px;
            background: #2a2d35;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="test-container">
    <h1>ğŸ§ª SurvivalQuant Tests</h1>
    <div id="testResults"></div>
    <div id="testSummary" class="test-summary"></div>
</div>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script>
// í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
const TestUtils = {
    assertEquals(actual, expected, message = '') {
        if (actual !== expected) {
            throw new Error(`${message}\nExpected: ${expected}\nActual: ${actual}`);
        }
    },
    assertNotEquals(actual, expected, message = '') {
        if (actual === expected) {
            throw new Error(`${message}\nExpected not to be: ${expected}`);
        }
    },
    assertTrue(condition, message = '') {
        if (!condition) {
            throw new Error(`${message}\nExpected to be true`);
        }
    },
    assertFalse(condition, message = '') {
        if (condition) {
            throw new Error(`${message}\nExpected to be false`);
        }
    },
    assertDefined(value, message = '') {
        if (value === undefined) {
            throw new Error(`${message}\nExpected to be defined`);
        }
    },
    assertUndefined(value, message = '') {
        if (value !== undefined) {
            throw new Error(`${message}\nExpected to be undefined`);
        }
    },
    assertNull(value, message = '') {
        if (value !== null) {
            throw new Error(`${message}\nExpected to be null`);
        }
    },
    assertNotNull(value, message = '') {
        if (value === null) {
            throw new Error(`${message}\nExpected not to be null`);
        }
    },
    assertArrayEquals(actual, expected, message = '') {
        if (actual.length !== expected.length) {
            throw new Error(`${message}\nArray lengths differ. Expected: ${expected.length}, Actual: ${actual.length}`);
        }
        for (let i = 0; i < actual.length; i++) {
            if (actual[i] !== expected[i]) {
                throw new Error(`${message}\nArrays differ at index ${i}. Expected: ${expected[i]}, Actual: ${actual[i]}`);
            }
        }
    }
};

// í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê¸°
class TestRunner {
    constructor() {
        this.tests = [];
        this.results = {
            passed: 0,
            failed: 0,
            total: 0
        };
    }

    addTest(name, testFn) {
        this.tests.push({ name, testFn });
    }

    async runTests() {
        const resultsDiv = document.getElementById('testResults');
        const summaryDiv = document.getElementById('testSummary');
        
        for (const test of this.tests) {
            const testCase = document.createElement('div');
            testCase.className = 'test-case';
            
            try {
                await test.testFn();
                testCase.innerHTML = `
                    <div class="test-result">
                        <span class="pass">âœ“</span>
                        <span>${test.name}</span>
                    </div>
                `;
                this.results.passed++;
            } catch (error) {
                testCase.innerHTML = `
                    <div class="test-result">
                        <span class="fail">âœ—</span>
                        <span>${test.name}</span>
                    </div>
                    <div class="error-details">${error.message}</div>
                `;
                this.results.failed++;
            }
            
            resultsDiv.appendChild(testCase);
        }
        
        this.results.total = this.tests.length;
        summaryDiv.innerHTML = `
            <h3>í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h3>
            <p>ì´ í…ŒìŠ¤íŠ¸: ${this.results.total}</p>
            <p class="pass">í†µê³¼: ${this.results.passed}</p>
            <p class="fail">ì‹¤íŒ¨: ${this.results.failed}</p>
        `;
    }
}

// í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤
const runner = new TestRunner();

// í•˜ì´í‚¨ì•„ì‹œ ë³€í™˜ í…ŒìŠ¤íŠ¸
runner.addTest('í•˜ì´í‚¨ì•„ì‹œ ë³€í™˜ - ë¹ˆ ë°°ì—´ ì…ë ¥', () => {
    const result = heikinAshiTransform([]);
    TestUtils.assertTrue(Array.isArray(result), 'ê²°ê³¼ëŠ” ë°°ì—´ì´ì–´ì•¼ í•¨');
    TestUtils.assertEquals(result.length, 0, 'ë¹ˆ ë°°ì—´ì´ ë°˜í™˜ë˜ì–´ì•¼ í•¨');
});

runner.addTest('í•˜ì´í‚¨ì•„ì‹œ ë³€í™˜ - ë‹¨ì¼ ìº”ë“¤ ì…ë ¥', () => {
    const input = [{
        timestamp: 1000,
        open: 100,
        high: 110,
        low: 90,
        close: 105,
        volume: 1000
    }];
    
    const result = heikinAshiTransform(input);
    TestUtils.assertEquals(result.length, 1, 'ê²°ê³¼ ë°°ì—´ ê¸¸ì´ëŠ” 1ì´ì–´ì•¼ í•¨');
    TestUtils.assertEquals(result[0].open, (100 + 105) / 2, 'ì²« ìº”ë“¤ì˜ ì‹œê°€ ê³„ì‚°');
    TestUtils.assertEquals(result[0].close, (100 + 110 + 90 + 105) / 4, 'ì²« ìº”ë“¤ì˜ ì¢…ê°€ ê³„ì‚°');
});

// ì›¹ì†Œì¼“ ì—°ê²° í…ŒìŠ¤íŠ¸
runner.addTest('ì›¹ì†Œì¼“ ì—°ê²° ì´ˆê¸°í™”', () => {
    const ws = new WebSocket('wss://api.upbit.com/websocket/v1');
    TestUtils.assertNotNull(ws, 'ì›¹ì†Œì¼“ ê°ì²´ê°€ ìƒì„±ë˜ì–´ì•¼ í•¨');
    TestUtils.assertEquals(ws.url, 'wss://api.upbit.com/websocket/v1', 'ì˜¬ë°”ë¥¸ URLë¡œ ì—°ê²°');
    ws.close();
});

// ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸
runner.addTest('ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”', () => {
    const container = document.createElement('div');
    container.id = 'tvChart';
    document.body.appendChild(container);
    
    const chart = LightweightCharts.createChart(container, {
        width: 400,
        height: 300
    });
    
    TestUtils.assertNotNull(chart, 'ì°¨íŠ¸ ê°ì²´ê°€ ìƒì„±ë˜ì–´ì•¼ í•¨');
    TestUtils.assertTrue(typeof chart.resize === 'function', 'ì°¨íŠ¸ ê°ì²´ëŠ” resize ë©”ì„œë“œë¥¼ ê°€ì ¸ì•¼ í•¨');
    
    chart.remove();
    container.remove();
});

// í…ŒìŠ¤íŠ¸ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', () => {
    runner.runTests().catch(console.error);
});
</script>
</body>
</html> 