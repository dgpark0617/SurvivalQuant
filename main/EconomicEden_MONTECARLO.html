<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>íŠ¸ë ˆì´ë”© ëª¬í…Œì¹´ë¥¼ë¡œ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f6fa;
      color: #222;
      min-height: 100vh;
    }
    .sim-section {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      margin: 32px auto 0 auto;
      width: 100%;
      max-width: 1200px;
      min-width: 320px;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    .section-title {
      background: #1a1a1a;
      color: #fff;
      padding: 20px 0 12px 0;
      text-align: center;
      border-radius: 12px 12px 0 0;
      margin: 0;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .main-title {
      font-size: clamp(1.1em, 2.5vw, 2em);
      font-weight: 600;
    }
    .kakao-link {
      display: flex;
      align-items: center;
      gap: 0.3em;
      background: #fee500;
      color: #181600;
      border-radius: 6px;
      padding: 0.25em 0.7em 0.25em 0.5em;
      font-size: 0.98em;
      font-weight: 500;
      text-decoration: none;
      transition: background 0.2s;
      margin: 10px auto 0 auto;
      max-width: 260px;
      justify-content: center;
    }
    .kakao-link:hover {
      background: #ffe066;
    }
    .kakao-icon {
      width: 1.3em;
      height: 1.3em;
      display: inline-block;
      vertical-align: middle;
    }
    .sub-title {
      font-size: clamp(0.9em, 1.5vw, 1.2em);
      color: #cccccc;
      font-weight: normal;
      margin-top: 0.5em;
    }
    #expire-status {
      margin-top: 6px;
      font-size: 1em;
      color: #fff;
      font-weight: 600;
    }
    main {
      width: 100%;
      max-width: 900px;
      margin: 2rem auto 3rem auto;
      background: none;
      border-radius: 0;
      box-shadow: none;
      padding: 2rem;
    }
    label { font-weight:500; display: inline-block; line-height: 1.5;}
    .form-row { 
      display: flex; 
      align-items: center; 
      gap: 1.5em; 
      margin-bottom: 1em;
      min-height: 36px;
    }
    .form-row label {
      min-width: 180px;
      margin: 0;
      flex-shrink: 0;
    }
    .form-row input[type="number"] { 
      width: 100px; 
      padding: 0.5em;
      height: 36px;
      box-sizing: border-box;
    }
    .form-row input[type="range"] { 
      width: 150px;
      margin: 0;
    }
    .form-row input[type="checkbox"] { 
      width: 1.1em; 
      height: 1.1em;
      margin: 0;
    }
    .desc { 
      color: #555; 
      font-size: 0.97em; 
      margin: 0 0 0 0.5em;
    }
    button { background: #222; color: #fff; font-size:1.1em; border:none; border-radius:5px; padding:0.5em 2em; cursor:pointer; margin-top:1em;}
    button:disabled { opacity:0.6;}
    .progress-bar { background: #e8e8e8; border-radius:10px; overflow:hidden; height:22px; margin:1em 0;}
    .progress-inner { background: #2b72ff; height:100%; transition: width 0.15s;}
    .stats-table { width:100%; border-collapse:collapse; margin-top:1.5em;}
    .stats-table th, .stats-table td { border:1px solid #ddd; padding:0.5em 0.7em; text-align:right;}
    .stats-table th { background: #f3f3f3; color:#222;}
    .stats-table td.metric { background: #f9f9f9; text-align:left;}
    .summary-box { background: #f6faff; border-left: 6px solid #2b72ff; padding:1em 1.5em; margin:2em 0 1em 0; border-radius: 8px;}
    .footer { text-align:center; color:#888; margin:2em 0 1em 0; font-size:0.97em;}
    .badge { background: #2b72ff; color:#fff; border-radius:12px; padding:0.15em 0.9em; font-size:0.83em; margin-left:0.4em;}
    .result-section { margin-top:2em;}
    @media (max-width:900px) {
      .sim-section { max-width: 98vw; }
      main { max-width: 98vw; padding: 1em; }
    }
    @media (max-width:650px){
      main { padding:1em; }
      .form-row { flex-direction:column; align-items:flex-start;}
      .stats-table th, .stats-table td { font-size:0.93em;}
    }
    @media (max-width: 600px) {
      html, body, .sim-section, main, .result-section {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
      }
      main, .sim-section, .result-section, .stats-vertical-table-wrapper {
        padding-left: 12px !important;
        padding-right: 12px !important;
      }
      .stats-table { display: none !important; }
      .stats-vertical-table-wrapper {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: auto !important;
        box-sizing: border-box !important;
        background: #fff;
      }
      .stats-vertical-table {
        display: table !important;
        width: 100% !important;
        max-width: 100% !important;
        table-layout: fixed !important;
        font-size: 0.93em !important;
        margin-bottom: 0 !important;
        box-sizing: border-box !important;
      }
      .stats-vertical-table th, .stats-vertical-table td {
        padding: 0.35em 0.3em !important;
        word-break: break-all !important;
        box-sizing: border-box !important;
      }
    }
    @media (min-width: 601px) {
      .stats-vertical-table, .stats-vertical-table-wrapper { display: none !important; }
    }
    .stats-vertical-table {
      border-collapse: collapse;
      margin-top: 1.5em;
      width: 100%;
    }
    .stats-vertical-table th, .stats-vertical-table td {
      border: 1px solid #ddd;
      padding: 0.5em 0.7em;
      text-align: right;
      font-size: 0.97em;
    }
    .stats-vertical-table th {
      background: #f3f3f3;
      color: #222;
      text-align: center;
    }
    .stats-vertical-table td.metric {
      background: #f9f9f9;
      text-align: left;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="sim-section">
    <div class="section-title">
      <div class="section-title-row">
        <div class="main-title">íŠ¸ë ˆì´ë”© ëª¬í…Œì¹´ë¥¼ë¡œ ì‹œë®¬ë ˆì´í„°</div>
      </div>
      <a class="kakao-link" href="https://open.kakao.com/o/sy2UErbd" target="_blank" rel="noopener noreferrer" style="margin: 10px auto 0 auto; display: flex; align-items: center; justify-content: center; max-width: 260px;">
        <span class="kakao-icon">
          <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="20" cy="20" r="20" fill="#FEE500"/>
            <path d="M20 10C13.9249 10 9 13.6863 9 18.1111C9 21.0192 11.2222 23.4956 14.4444 24.6667L13.3333 29.1111C13.2222 29.5556 13.6667 29.8889 14.0556 29.6667L19.1111 26.6667C19.3981 26.6842 19.6981 26.6944 20 26.6944C26.0751 26.6944 31 23.0081 31 18.5833C31 14.1585 26.0751 10 20 10Z" fill="#181600"/>
          </svg>
        </span>
        ìë™ë§¤ë§¤ ì œì‘ì˜ë¢°
      </a>
      <div class="sub-title">ì „ëµì˜ ì¥ê¸°ì  ìˆ˜ìµì„±ê³¼ ìœ„í—˜ì„ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ ê²€ì¦í•˜ì„¸ìš”</div>
      <div id="expire-status" style="margin-top:6px; font-size:1em; color:#fff; font-weight:600;"></div>
    </div>
    <main>
      <form id="sim-form" autocomplete="off">
        <h2>ì…ë ¥ íŒŒë¼ë¯¸í„°</h2>
        <div class="form-row">
          <label for="capital">ì´ˆê¸° ìë³¸(â‚©)</label>
          <input type="number" id="capital" min="5000" step="1000" value="10000000">
          <span class="desc">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ì‹œ ë³´ìœ í•œ ì´ˆê¸° ìë³¸ê¸ˆ</span>
        </div>
        <div class="form-row">
          <label for="bet_size">ë² íŒ… ê¸ˆì•¡(â‚©/íšŒ)</label>
          <input type="number" id="bet_size" min="100" step="100" value="100000">
          <span class="desc">ë§¤ ê±°ë˜ë‹¹ íˆ¬ìí•˜ëŠ” ê¸ˆì•¡</span>
        </div>
        <div class="form-row">
          <label for="win_prob">ìŠ¹ë¥ (%)</label>
          <input type="number" id="win_prob" min="5" max="95" step="0.1" value="40">
          <span class="desc">ì „ì²´ ê±°ë˜ ì¤‘ ìˆ˜ìµì´ ë°œìƒí•˜ëŠ” ë¹„ìœ¨ (ì˜ˆ: 35 â†’ 35%)</span>
        </div>
        <div class="form-row">
          <label for="avg_win_rate">í‰ê·  ìµì ˆë¥ (%)</label>
          <input type="number" id="avg_win_rate" min="0.1" max="100" step="0.01" value="3">
          <span class="desc">ì˜ˆ: 1.4 â†’ +1.4% (ìˆ˜ìµ ë°œìƒ ì‹œ í‰ê·  ìˆ˜ìµë¥ )</span>
        </div>
        <div class="form-row">
          <label for="avg_loss_rate">í‰ê·  ì†ì ˆë¥ (%)</label>
          <input type="number" id="avg_loss_rate" max="-0.01" min="-100" step="0.01" value="-1">
          <span class="desc">ì˜ˆ: -0.5 â†’ -0.5% (ì†ì‹¤ ë°œìƒ ì‹œ í‰ê·  ì†ì‹¤ë¥ )</span>
        </div>
        <div class="form-row">
          <label for="commission_rate">ìˆ˜ìˆ˜ë£Œ(%)</label>
          <input type="number" id="commission_rate" min="0" max="1" step="0.001" value="0.1">
          <span class="desc">ê±°ë˜ 1íšŒë‹¹(ë§¤ìˆ˜/ë§¤ë„ í•©ì‚°), ì˜ˆ: 0.1 â†’ 0.1%</span>
        </div>
        <div class="form-row">
          <label for="num_trades">ì´ ê±°ë˜ íšŸìˆ˜</label>
          <input type="number" id="num_trades" min="10" max="5000" step="10" value="100">
          <span class="desc">ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì‹¤í–‰í•  ì´ ê±°ë˜ íšŸìˆ˜</span>
        </div>
        <div class="form-row">
          <label for="max_streak_simulations">ì‹œë®¬ë ˆì´ì…˜ ë°˜ë³µ(íšŒ)</label>
          <input type="number" id="max_streak_simulations" min="10" max="3000" step="10" value="500">
          <span class="desc">ëª¬í…Œì¹´ë¥¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ ë°˜ë³µ íšŸìˆ˜ (ë§ì„ìˆ˜ë¡ ì •í™•)</span>
        </div>
        <div class="form-row">
          <label for="cluster_coeff">ì—°ì†ì„±(ìŠ¤í‹°í‚¤)</label>
          <input type="number" id="cluster_coeff" min="0" max="1" step="0.01" value="0.5">
          <span class="desc">0=ì™„ì „ëœë¤, 1=ì—°ì†ìŠ¹/ì—°ì†íŒ¨ í´ëŸ¬ìŠ¤í„° (ì‹œì¥ì˜ ì¶”ì„¸ ë°˜ì˜)</span>
        </div>
        <div class="form-row">
          <label for="enable_black_swan">ë¸”ë™ìŠ¤ì™„ ì´ë²¤íŠ¸</label>
          <input type="checkbox" id="enable_black_swan" checked>
          <span class="desc">í¬ë°•í•˜ì§€ë§Œ ì¹˜ëª…ì  ì†ì‹¤ ì´ë²¤íŠ¸ í™œì„±í™”</span>
        </div>
        <div class="form-row">
          <label for="black_swan_prob">ë¸”ë™ìŠ¤ì™„ ë°œìƒí™•ë¥ (%)</label>
          <input type="number" id="black_swan_prob" min="0" max="1" step="0.001" value="0.1">
          <span class="desc">ê±°ë˜ 1íšŒë‹¹, ì˜ˆ: 0.1 â†’ 0.1%</span>
        </div>
        <div class="form-row">
          <label for="black_swan_loss_pct">ë¸”ë™ìŠ¤ì™„ ìë³¸ì†ì‹¤(%)</label>
          <input type="number" id="black_swan_loss_pct" min="0" max="100" step="0.1" value="10">
          <span class="desc">ìë³¸ì˜ ëª‡ % ì†ì‹¤, ì˜ˆ: 10 â†’ 10%</span>
        </div>
        <button type="submit" id="run-btn">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
        <div id="form-error" style="color:#c00; margin-top:0.7em; display:none;"></div>
        <div class="progress-bar" style="display:none;">
          <div class="progress-inner" style="width:0%;"></div>
        </div>
      </form>
      <section class="result-section">
        <div id="result"></div>
      </section>
      <details style="margin-top:2em;">
        <summary><b>Reward/Risk ìš”êµ¬ì¹˜ í‘œ (ì°¸ê³ ìš©)</b></summary>
        <div style="overflow-x:auto; margin-top:1em;">
          <table class="stats-table" style="font-size:0.97em;">
            <thead>
              <tr>
                <th>ìŠ¹ë¥ (%)</th>
                <th>10</th><th>15</th><th>20</th><th>25</th><th>30</th><th>35</th><th>40</th><th>45</th><th>50</th>
                <th>55</th><th>60</th><th>65</th><th>70</th><th>75</th><th>80</th><th>85</th><th>90</th><th>95</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Required R/R</td><td>9.0</td><td>5.7</td><td>4.0</td><td>3.0</td><td>2.3</td><td>1.9</td><td>1.5</td><td>1.2</td><td>1.0</td>
                  <td>0.8</td><td>0.7</td><td>0.5</td><td>0.4</td><td>0.3</td><td>0.3</td><td>0.2</td><td>0.1</td><td>0.1</td></tr>
              <tr><td>R/R=1.5+</td><td>13.5</td><td>8.7</td><td>6.0</td><td>4.5</td><td>3.5</td><td>2.8</td><td>2.3</td><td>1.9</td><td>1.5</td>
                  <td>1.2</td><td>1.0</td><td>0.8</td><td>0.6</td><td>0.5</td><td>0.4</td><td>0.3</td><td>0.2</td><td>0.1</td></tr>
              <tr><td>R/R=2.0+</td><td>18.0</td><td>11.3</td><td>8.0</td><td>6.0</td><td>4.7</td><td>3.7</td><td>3.0</td><td>2.4</td><td>2.0</td>
                  <td>1.6</td><td>1.3</td><td>1.0</td><td>0.7</td><td>0.5</td><td>0.4</td><td>0.3</td><td>0.2</td><td>0.1</td></tr>
              <tr><td>R/R=2.5+</td><td>22.5</td><td>13.9</td><td>10.0</td><td>7.5</td><td>5.8</td><td>4.7</td><td>3.8</td><td>2.8</td><td>2.5</td>
                  <td>2.0</td><td>1.7</td><td>1.3</td><td>0.9</td><td>0.7</td><td>0.5</td><td>0.4</td><td>0.2</td><td>0.1</td></tr>
            </tbody>
          </table>
        </div>
        <ul style="margin-top:0.7em; color:#456;">
          <li>Required R/R = (1-ìŠ¹ë¥ )/ìŠ¹ë¥ </li>
          <li>ìœ„ í‘œëŠ” êµ¬ì¡°ì  ìˆ˜ìµì„±(ì¥ê¸°ì ìœ¼ë¡œ ìˆ˜ìµêµ¬ì¡°ê°€ ê°€ëŠ¥í•œì§€) ì°¸ê³ ìš©ì…ë‹ˆë‹¤.</li>
        </ul>
      </details>
    </main>
    <div class="footer">
      <b>Â© 2024-2025 Starfox119</b> | ì˜¤í”ˆì†ŒìŠ¤ ì½”ë“œ ê¸°ë°˜ | <a href="https://github.com/Starfox119" target="_blank">GitHub</a>
    </div>
  </div>
  <script>
    // =============================
    // [ì—¬ê¸°ë§Œ ìˆ˜ì •] ë§ˆê°ê¸°í•œì„ ë³€ê²½í•˜ì„¸ìš”!
    // ì˜ˆì‹œ: 2025-07-31
    const expireDate = new Date('2025-07-31T23:59:59');
    // =============================
    function getExpireStatus() {
      const now = new Date();
      const diff = expireDate - now;
      if (diff < 0) return { expired: true, text: 'ì‚¬ìš©ê¸°ê°„ ë§Œë£Œ' };
      const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
      return { expired: false, text: `ì‚¬ìš©ê¸°ê°„ D-${days} (${expireDate.getFullYear()}-${String(expireDate.getMonth()+1).padStart(2,'0')}-${String(expireDate.getDate()).padStart(2,'0')}ê¹Œì§€)` };
    }
    // ë§Œë£Œ ì•ˆë‚´ í‘œì‹œ í•¨ìˆ˜
    function showExpireStatus() {
      const status = getExpireStatus();
      const expireElem = document.getElementById('expire-status');
      if (expireElem) expireElem.textContent = status.text;
      if (status.expired) {
        document.body.innerHTML = `<div style="text-align:center; margin-top:100px; font-size:1.5em; color:#c00;">ì´ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.</div>`;
        throw new Error('ì„œë¹„ìŠ¤ ë§Œë£Œ');
      }
    }
    // window.onload ë˜í¼ ì œê±° ë° ë‚´ë¶€ ì½”ë“œ ì§ì ‘ ë°°ì¹˜ ì‹œì‘
    showExpireStatus();
    // =========================
    // Utility (JS version)
    // =========================
    function calcKelly(win_prob, win_rate, loss_rate) {
      const b = loss_rate !== 0 ? win_rate / Math.abs(loss_rate) : 0;
      const p = win_prob;
      const q = 1 - p;
      const kelly = b !== 0 ? (b * p - q) / b : 0;
      return Math.max(0, kelly * 100);
    }
    function minRequiredWinProfit(win_rate, avg_loss, fee_rate) {
      const f = 2 * fee_rate;
      const p = win_rate;
      const L = avg_loss;
      if (p === 0) return Infinity;
      return (f - L) / p + L;
    }
    function safeKellyRatio(maxLosingStreak, minRemainRatio=0.01) {
      // minRemainRatio: íŒŒì‚° ëŒ€ì‹  ë‚¨ê¸°ê³  ì‹¶ì€ ìµœì†Œ ìë³¸ ë¹„ìœ¨ (ì˜ˆ: 0.01 = 1%)
      if (maxLosingStreak <= 0) return 0;
      return 1 - Math.pow(minRemainRatio, 1 / maxLosingStreak);
    }
    // =========================
    // Core Simulation (JS)
    // =========================
    function simulateStrategy(cfg, trackStreak=true, trackMdd=true) {
      let wins = 0, losses = 0, total_profit = 0, total_loss = 0, total_commission = 0;
      let streak = 0, max_lose_streak = 0;
      let capital = cfg.initial_capital, max_capital = cfg.initial_capital;
      let mdd = 0, mdd_pct = 0;
      const bet_size = cfg.bet_size;
      const win_prob = cfg.win_prob;
      const avg_win_rate = cfg.avg_win_rate;
      const avg_loss_rate = cfg.avg_loss_rate;
      const num_trades = cfg.num_trades;
      const commission_rate = cfg.commission_rate;
      const cluster_coeff = cfg.cluster_coeff;
      const black_swan_prob = cfg.black_swan_prob;
      const black_swan_loss_pct = cfg.black_swan_loss_pct;
      const enable_black_swan = cfg.enable_black_swan;
      let prev_win = Math.random() < win_prob;
      let trade_results = [];
      for(let i=0; i<num_trades; ++i){
        if(capital < bet_size) break;
        // Black Swan
        if(enable_black_swan && Math.random() < black_swan_prob){
          capital -= capital * black_swan_loss_pct;
        }
        // Clustered win/loss
        let curr_win;
        if(Math.random() < cluster_coeff){
          curr_win = prev_win;
        }else{
          curr_win = Math.random() < win_prob;
        }
        const commission = bet_size * commission_rate;
        total_commission += commission;
        if(curr_win){
          const profit = bet_size * avg_win_rate;
          capital += profit - commission;
          total_profit += profit;
          wins += 1;
          trade_results.push({win: true, profit: profit, loss: 0});
          if(trackStreak) streak = 0;
          prev_win = true;
        }else{
          const loss = bet_size * Math.abs(avg_loss_rate);
          capital -= (loss + commission);
          total_loss += loss;
          losses += 1;
          trade_results.push({win: false, profit: 0, loss: loss});
          if(trackStreak){
            streak += 1;
            if(streak > max_lose_streak) max_lose_streak = streak;
          }
          prev_win = false;
        }
        if(trackMdd){
          if(capital > max_capital){
            max_capital = capital;
          }
          const drawdown = max_capital - capital;
          mdd_pct = Math.max(mdd_pct, (max_capital>0 ? drawdown/max_capital : 0));
          mdd = Math.max(mdd, drawdown);
        }
      }
      const profit_factor = total_loss !== 0 ? (total_profit/total_loss) : (total_profit>0?Infinity:-Infinity);
      const recovery_factor = mdd !== 0 ? (total_profit/mdd) : (total_profit>0?Infinity:-Infinity);
      const seed_change = (capital-cfg.initial_capital)/cfg.initial_capital*100;
      // ì‹¤ì œ ì‹¤í˜„ëœ ìŠ¹ë¥ , í‰ê·  ìµì ˆë¥ , í‰ê·  ì†ì ˆë¥  ê³„ì‚°
      const realized_win_prob = (wins + losses) > 0 ? wins / (wins + losses) : 0;
      const realized_avg_win_rate = wins > 0 ? (total_profit / (wins * bet_size)) : 0;
      const realized_avg_loss_rate = losses > 0 ? -(total_loss / (losses * bet_size)) : 0;
      // ì‹¤ì œ ê¸°ëŒ€ ìˆ˜ìµë¥ , ì¼ˆë¦¬ ë¹„ìœ¨ ê³„ì‚°
      const realized_expectancy = realized_win_prob * realized_avg_win_rate + (1 - realized_win_prob) * realized_avg_loss_rate;
      const realized_kelly_pct = calcKelly(realized_win_prob, realized_avg_win_rate, realized_avg_loss_rate);
      // ì•ˆì „ ì¼ˆë¦¬ ë¹„ìœ¨(%) ê³„ì‚° (ìë³¸ 1% ì´ìƒ ë‚¨ë„ë¡)
      const safe_kelly = safeKellyRatio(max_lose_streak) * 100;
      return {
        'Final Capital': capital,
        'Seed Change (%)': seed_change,
        'Total Profit': total_profit,
        'Total Loss': total_loss,
        'Profit Factor': profit_factor,
        'Total Commission': total_commission,
        'Win Count': wins,
        'Loss Count': losses,
        'Total Trades': wins+losses,
        'Max Losing Streak': max_lose_streak,
        'Max Drawdown': mdd,
        'Max Drawdown (%)': -mdd_pct*100,
        'Recovery Factor': recovery_factor,
        'Expectancy (%)': realized_expectancy*100,
      };
    }
    async function montecarloSimulation(cfg, onProgress) {
      const N = cfg.max_streak_simulations;
      let results = [];
      for(let i=0; i<N; ++i){
        results.push(simulateStrategy(cfg, true, true));
        if(i%10===0 && onProgress) onProgress(i/N);
        // for UI responsiveness
        if(i%50===0) await new Promise(r=>setTimeout(r,0));
      }
      if(onProgress) onProgress(1);
      return results;
    }
    // =========================
    // Statistics & Reporting
    // =========================
    function calcStatsFromList(arr){
      arr = arr.slice().sort((a,b)=>a-b);
      const mean = arr.reduce((a,b)=>a+b,0)/arr.length;
      const median = arr.length%2===1 ? arr[(arr.length-1)/2] : (arr[arr.length/2-1]+arr[arr.length/2])/2;
      const min = arr[0], max = arr[arr.length-1];
      const std = Math.sqrt(arr.reduce((a,b)=>a+(b-mean)*(b-mean),0)/arr.length);
      function percentile(p){
        if(arr.length===0) return 0;
        const idx = Math.ceil((p/100)*arr.length)-1;
        return arr[Math.max(0,Math.min(arr.length-1,idx))];
      }
      return {
        'Median': median,
        'Mean': mean,
        'Min': min,
        'Max': max,
        'Std': std,
        '90%tile': percentile(90),
        '95%tile': percentile(95),
        '99%tile': percentile(99)
      };
    }
    function summarizeMontecarloResults(results, metrics){
      let summary = {};
      for(const metric of metrics){
        summary[metric] = calcStatsFromList(results.map(r=>r[metric]));
      }
      return summary;
    }
    function formatNum(n, digits=2){ 
      if(!isFinite(n)) return 'âˆ';
      return n>=1e6 ? n.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,',') : n.toFixed(digits);
    }
    function formatPct(n, forceMinus=false){
      if(!isFinite(n)) return 'âˆ';
      if(forceMinus) return n.toFixed(2) + ' %'; // ë¶€í˜¸ ê·¸ëŒ€ë¡œ ì¶œë ¥
      return (n>=0?'+':'') + n.toFixed(2) + ' %';
    }
    function formatMetricTable(summary, config) {
      const col_order = ["Median", "Mean", "Min", "Max", "Std", "90%tile", "95%tile", "99%tile"];
      const col_names = ["ì¤‘ì•™ê°’", "í‰ê· ", "ìµœì†Œ", "ìµœëŒ€", "í‘œì¤€í¸ì°¨", "90%", "95%", "99%"];
      let rows = [];
      const metrics = Object.keys(summary);
      
      // í‘œ ë Œë”ë§: ì¡°ê±´ë¶€(ì´ˆê¸° ìë³¸, ë² íŒ… ê¸ˆì•¡)ë§Œ ìƒë‹¨ì— rows.pushë¡œ ì¶”ê°€
      rows.push(['<b>ì´ˆê¸° ìë³¸</b>', ...col_order.map(()=>formatNum(config.initial_capital,0))]);
      rows.push(['<b>ë² íŒ… ê¸ˆì•¡</b>', ...col_order.map(()=>formatNum(config.bet_size,0))]);
      
      // stat rows
      for(const metric of metrics) {
        const isPct = metric.match(/%/);
        const isMdd = metric === "Max Drawdown (%)";
        const koreanMetric = metricsMap[metric] || metric;
        rows.push([
          koreanMetric,
          ...col_order.map(c=>isPct ? formatPct(summary[metric][c], isMdd) : formatNum(summary[metric][c]))
        ]);
      }
      
      // header
      let thead = '<tr><th>ì§€í‘œ</th>' + col_names.map(c=>`<th>${c}</th>`).join('') + '</tr>';
      let tbody = rows.map(r=>'<tr>' + r.map((v,i)=>i===0?`<td class="metric">${v}</td>`:`<td>${v}</td>`).join('') + '</tr>').join('');
      return `<table class="stats-table">${thead}${tbody}</table>`;
    }
    function analyzeStrategy(summary, config){
      const seed_change = summary["Seed Change (%)"]["Mean"];
      const expectancy = summary["Expectancy (%)"]["Mean"];
      const mdd = summary["Max Drawdown (%)"]["Mean"];
      const profit_factor = summary["Profit Factor"]["Mean"];
      const max_streak = summary["Max Losing Streak"]["Mean"];
      const min_win_profit = minRequiredWinProfit(
        config.win_prob,
        config.avg_loss_rate,
        config.commission_rate
      );
      const avg_win_rate = config.avg_win_rate;
      let html = `<div class="summary-box"><b>ì „ëµ ì„±ê³¼ ìš”ì•½</b><br/><br/>`;
      html += `<b>ê¸°ëŒ€ê°’ (Expectancy):</b> ${formatPct(expectancy)}<br/>`;
      html += `<b>í‰ê·  Seed ë³€í™”:</b> ${formatPct(seed_change)}<br/>`;
      html += `<b>í‰ê·  Max Drawdown:</b> ${formatPct(mdd)}<br/>`;
      html += `<b>Profit Factor:</b> ${formatNum(profit_factor)}<br/>`;
      html += `<b>ìµœëŒ€ ì—°ì† ì†ì‹¤:</b> ${formatNum(max_streak,1)}<br/>`;
      html += `<b>ìµœì†Œ ìš”êµ¬ ìµì ˆë¥ :</b> ${formatPct(min_win_profit*100)}<br/>`;
      html += `<b>í˜„ì¬ í‰ê·  ìµì ˆë¥ :</b> ${formatPct(avg_win_rate*100)}<br/>`;
      html += `<hr style="margin:0.7em 0;"/>`;
      if(avg_win_rate < min_win_profit){
        html += `<span style="color:#c00"><b>- í˜„ì¬ í‰ê·  ìµì ˆë¥ ì´ ìµœì†Œ ìš”êµ¬ì¹˜ë³´ë‹¤ ë‚®ì•„ êµ¬ì¡°ì ìœ¼ë¡œ ì ì ì „ëµì…ë‹ˆë‹¤.</b></span><br/>`;
      }else if(seed_change < 0 || expectancy < 0){
        html += `<span style="color:#c00"><b>- ê¸°ëŒ€ê°’ ë˜ëŠ” í‰ê·  seed ë³€í™”ê°€ 0 ì´í•˜ì…ë‹ˆë‹¤. ì¥ê¸°ì ìœ¼ë¡œ ìë³¸ì´ ê°ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</b></span><br/>`;
      }else{
        html += `<span style="color:#295"><b>- ì¥ê¸°ì ìœ¼ë¡œ ìë³¸ì´ ì¦ê°€í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.</b></span><br/>`;
      }
      // ì¶”ì²œì‚¬í•­ ê°œì„ : í•­ìƒ ìµœì†Œ 1ê°œ ë©”ì‹œì§€ ì¶œë ¥
      let recommendations = [];
      if(avg_win_rate < min_win_profit){
        recommendations.push("ìµì ˆë¥ ì„ ë†’ì´ê±°ë‚˜ ì†ì‹¤ë¥ /ìˆ˜ìˆ˜ë£Œë¥¼ ë‚®ì¶”ëŠ” êµ¬ì¡° ê°œì„  í•„ìš”");
      }
      if(profit_factor < 1.5){
        recommendations.push("Profit Factor(ì†ìµë¹„)ê°€ 1.5 ë¯¸ë§Œ â†’ ìˆ˜ìµ/ìœ„í—˜ êµ¬ì¡° ê°œì„  í•„ìš”");
      }
      if(mdd > 50){
        recommendations.push("í‰ê·  Max Drawdownì´ 50% ì´ˆê³¼ â†’ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê°•í™” í•„ìš”");
      }
      if(max_streak > 20){
        recommendations.push("ìµœëŒ€ ì—°ì† ì†ì‹¤ì´ 20íšŒ ì´ˆê³¼ â†’ í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ/ì†ì ˆ ì „ëµ ì ê²€ í•„ìš”");
      }
      if(expectancy > 0 && expectancy < 0.5){
        recommendations.push("ê¸°ëŒ€ê°’ì´ 0.5% ë¯¸ë§Œ â†’ ì „ëµ ê°œì„  í•„ìš”");
      }
      if(recommendations.length === 0){
        recommendations.push("ëª¨ë“  ì£¼ìš” ë¦¬ìŠ¤í¬/ìˆ˜ìµ ì§€í‘œê°€ ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ì¬ ì „ëµì„ ìœ ì§€í•˜ê±°ë‚˜, ì¶”ê°€ ê°œì„ ì„ ì‹œë„í•´ë³´ì„¸ìš”.");
      }
      html += `<br/><b>ì¶”ì²œì‚¬í•­</b><ul style="margin-top:0.3em;">` + recommendations.map(r=>`<li>${r}</li>`).join('') + `</ul>`;
      return html;
    }
    // =========================
    // Form & Event Logic
    // =========================
    function getFormConfig(){
      function val(id, fn){ return fn(document.getElementById(id).value);}
      function valC(id){ return document.getElementById(id).checked;}
      return {
        initial_capital: val('capital', Number),
        bet_size: val('bet_size', Number),
        win_prob: val('win_prob', v=>Number(v)/100),
        avg_win_rate: val('avg_win_rate', v=>Number(v)/100),
        avg_loss_rate: val('avg_loss_rate', v=>Number(v)/100),
        num_trades: val('num_trades', Number),
        commission_rate: val('commission_rate', v=>Number(v)/100),
        max_streak_simulations: val('max_streak_simulations', Number),
        cluster_coeff: val('cluster_coeff', Number),
        black_swan_prob: val('black_swan_prob', v=>Number(v)/100),
        black_swan_loss_pct: val('black_swan_loss_pct', v=>Number(v)/100),
        enable_black_swan: valC('enable_black_swan')
      };
    }
    function validateConfig(cfg){
      if(cfg.bet_size > cfg.initial_capital) return "ë² íŒ… ê¸ˆì•¡ì´ ì´ˆê¸° ìë³¸ë³´ë‹¤ í½ë‹ˆë‹¤.";
      if(cfg.win_prob < 0.01 || cfg.win_prob > 0.99) return "ìŠ¹ë¥ ì€ 1~99% ë²”ìœ„ë¡œ ì…ë ¥í•˜ì„¸ìš”.";
      if(cfg.avg_win_rate <= 0) return "í‰ê·  ìµì ˆë¥ ì€ ì–‘ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.";
      if(cfg.avg_loss_rate >= 0) return "í‰ê·  ì†ì ˆë¥ ì€ ìŒìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.";
      if(cfg.num_trades < 10) return "ê±°ë˜íšŸìˆ˜ëŠ” 10íšŒ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
      if(cfg.max_streak_simulations < 10) return "ì‹œë®¬ë ˆì´ì…˜ ë°˜ë³µ íšŸìˆ˜ëŠ” 10íšŒ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
      if(cfg.commission_rate < 0) return "ìˆ˜ìˆ˜ë£ŒëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
      if(cfg.cluster_coeff < 0 || cfg.cluster_coeff>1) return "ì—°ì†ì„±ì€ 0~1 ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.";
      if(cfg.black_swan_prob < 0 || cfg.black_swan_prob > 1) return "ë¸”ë™ìŠ¤ì™„ í™•ë¥ ì€ 0~1% ë²”ìœ„ë¡œ ì…ë ¥í•˜ì„¸ìš”.";
      if(cfg.black_swan_loss_pct < 0 || cfg.black_swan_loss_pct > 1) return "ë¸”ë™ìŠ¤ì™„ ì†ì‹¤ë¥ ì€ 0~100% ë²”ìœ„ë¡œ ì…ë ¥í•˜ì„¸ìš”.";
      return "";
    }
    function showProgress(pct){
      const bar = document.querySelector('.progress-bar');
      const inner = document.querySelector('.progress-inner');
      bar.style.display='block';
      inner.style.width = (pct*100).toFixed(1)+'%';
    }
    function hideProgress(){
      document.querySelector('.progress-bar').style.display='none';
      document.querySelector('.progress-inner').style.width = '0%';
    }
    document.getElementById('sim-form').addEventListener('submit', async function(e){
      e.preventDefault();
      hideProgress();
      document.getElementById('result').innerHTML = '';
      document.getElementById('form-error').style.display='none';
      const cfg = getFormConfig();
      const err = validateConfig(cfg);
      if(err){
        document.getElementById('form-error').innerText=err;
        document.getElementById('form-error').style.display='block';
        return;
      }
      document.getElementById('run-btn').disabled=true;
      showProgress(0);
      
      const metricsMap = {
        "Initial Capital": "ì´ˆê¸° ìë³¸",
        "Bet Size": "ë² íŒ… ê¸ˆì•¡",
        "Total Trades": "ì´ ê±°ë˜ìˆ˜",
        "Max Drawdown (%)": "ìµœëŒ€ ë‚™í­(%)",
        "Max Losing Streak": "ìµœëŒ€ ì—°íŒ¨",
        "Recovery Factor": "íšŒë³µ íŒ©í„°",
        "Expectancy (%)": "ê¸°ëŒ€ ìˆ˜ìµë¥ (%)",
        "Seed Change (%)": "ìë³¸ê¸ˆ ë³€í™”ìœ¨(%)",
        "Profit Factor": "ìˆ˜ìµ íŒ©í„°",
        "Final Capital": "ìµœì¢… ìë³¸ê¸ˆ"
      };

      // ì˜ë¬¸-í•œê¸€ ì—­ë§¤í•‘ ìƒì„±
      const reverseMetricsMap = Object.fromEntries(
        Object.entries(metricsMap).map(([k, v]) => [v, k])
      );

      const METRICS = [
        "Total Trades",        // ì´ ê±°ë˜ìˆ˜
        "Max Drawdown (%)",    // ìµœëŒ€ ë‚™í­(%)
        "Max Losing Streak",   // ìµœëŒ€ ì—°íŒ¨
        "Profit Factor",       // ìˆ˜ìµ íŒ©í„° (íšŒë³µ íŒ©í„° ë°”ë¡œ ìœ„)
        "Recovery Factor",     // íšŒë³µ íŒ©í„°
        "Expectancy (%)",      // ê¸°ëŒ€ ìˆ˜ìµë¥ (%)
        "Seed Change (%)",     // ìë³¸ê¸ˆ ë³€í™”ìœ¨(%)
        "Final Capital"        // ìµœì¢… ìë³¸ê¸ˆ (ë§¨ ì•„ë˜)
      ];

      function formatMetricTable(summary, config) {
        const col_order = ["Median", "Mean", "Min", "Max", "Std", "90%tile", "95%tile", "99%tile"];
        const col_names = ["ì¤‘ì•™ê°’", "í‰ê· ", "ìµœì†Œ", "ìµœëŒ€", "í‘œì¤€í¸ì°¨", "90%", "95%", "99%"];
        let rows = [];
        const metrics = Object.keys(summary);
        
        // config rows
        rows.push(['<b>ì´ˆê¸° ìë³¸</b>', ...col_order.map(()=>formatNum(config.initial_capital,0))]);
        rows.push(['<b>ë² íŒ… ê¸ˆì•¡</b>', ...col_order.map(()=>formatNum(config.bet_size,0))]);
        
        // stat rows
        for(const metric of metrics) {
          const isPct = metric.includes('%');
          rows.push([
            metricsMap[metric],
            ...col_order.map(c=>isPct ? formatPct(summary[metric][c]) : formatNum(summary[metric][c]))
          ]);
        }
        
        // header
        let thead = '<tr><th>ì§€í‘œ</th>' + col_names.map(c=>`<th>${c}</th>`).join('') + '</tr>';
        let tbody = rows.map(r=>'<tr>' + r.map((v,i)=>i===0?`<td class="metric">${v}</td>`:`<td>${v}</td>`).join('') + '</tr>').join('');
        return `<table class="stats-table">${thead}${tbody}</table>`;
      }

      function analyzeStrategy(summary, config){
        const seed_change = summary["Seed Change (%)"]["Mean"];
        const expectancy = summary["Expectancy (%)"]["Mean"];
        const mdd = summary["Max Drawdown (%)"]["Mean"];
        const profit_factor = summary["Profit Factor"]["Mean"];
        const max_streak = summary["Max Losing Streak"]["Mean"];
        const min_win_profit = minRequiredWinProfit(
          config.win_prob,
          config.avg_loss_rate,
          config.commission_rate
        );
        const avg_win_rate = config.avg_win_rate;
        let html = `<div class="summary-box"><b>ì „ëµ ì„±ê³¼ ìš”ì•½</b><br/><br/>`;
        html += `<b>ê¸°ëŒ€ê°’ (Expectancy):</b> ${formatPct(expectancy)}<br/>`;
        html += `<b>í‰ê·  ìë³¸ê¸ˆ ë³€í™”ìœ¨:</b> ${formatPct(seed_change)}<br/>`;
        html += `<b>í‰ê·  ìµœëŒ€ ë‚™í­:</b> ${formatPct(mdd)}<br/>`;
        html += `<b>ìˆ˜ìµ íŒ©í„°:</b> ${formatNum(profit_factor)}<br/>`;
        html += `<b>ìµœëŒ€ ì—°ì† ì†ì‹¤:</b> ${formatNum(max_streak,1)}<br/>`;
        html += `<b>ìµœì†Œ ìš”êµ¬ ìµì ˆë¥ :</b> ${formatPct(min_win_profit*100)}<br/>`;
        html += `<b>í˜„ì¬ í‰ê·  ìµì ˆë¥ :</b> ${formatPct(avg_win_rate*100)}<br/>`;
        html += `<hr style="margin:0.7em 0;"/>`;
        if(avg_win_rate < min_win_profit){
          html += `<span style="color:#c00"><b>- í˜„ì¬ í‰ê·  ìµì ˆë¥ ì´ ìµœì†Œ ìš”êµ¬ì¹˜ë³´ë‹¤ ë‚®ì•„ êµ¬ì¡°ì ìœ¼ë¡œ ì ì ì „ëµì…ë‹ˆë‹¤.</b></span><br/>`;
        }else if(seed_change < 0 || expectancy < 0){
          html += `<span style="color:#c00"><b>- ê¸°ëŒ€ê°’ ë˜ëŠ” í‰ê·  seed ë³€í™”ê°€ 0 ì´í•˜ì…ë‹ˆë‹¤. ì¥ê¸°ì ìœ¼ë¡œ ìë³¸ì´ ê°ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</b></span><br/>`;
        }else{
          html += `<span style="color:#295"><b>- ì¥ê¸°ì ìœ¼ë¡œ ìë³¸ì´ ì¦ê°€í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.</b></span><br/>`;
        }
        // ì¶”ì²œì‚¬í•­ ê°œì„ : ê²½ê³  ìƒí™©(ê¸°ëŒ€ê°’/seed ë³€í™” 0 ì´í•˜) ìš°ì„  ë°˜ì˜
        let recommendations = [];
        if(seed_change < 0 || expectancy < 0){
          recommendations.push("ê¸°ëŒ€ê°’ ë˜ëŠ” í‰ê·  seed ë³€í™”ê°€ 0 ì´í•˜ì…ë‹ˆë‹¤. ì¥ê¸°ì ìœ¼ë¡œ ìë³¸ì´ ê°ì†Œí•  ìˆ˜ ìˆìœ¼ë‹ˆ ì „ëµì„ ë°˜ë“œì‹œ ì¬ì ê²€í•˜ì„¸ìš”.");
        }
        if(avg_win_rate < min_win_profit){
          recommendations.push("ìµì ˆë¥ ì„ ë†’ì´ê±°ë‚˜ ì†ì‹¤ë¥ /ìˆ˜ìˆ˜ë£Œë¥¼ ë‚®ì¶”ëŠ” êµ¬ì¡° ê°œì„  í•„ìš”");
        }
        if(profit_factor < 1.5){
          recommendations.push("Profit Factor(ì†ìµë¹„)ê°€ 1.5 ë¯¸ë§Œ â†’ ìˆ˜ìµ/ìœ„í—˜ êµ¬ì¡° ê°œì„  í•„ìš”");
        }
        if(mdd > 50){
          recommendations.push("í‰ê·  Max Drawdownì´ 50% ì´ˆê³¼ â†’ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê°•í™” í•„ìš”");
        }
        if(max_streak > 20){
          recommendations.push("ìµœëŒ€ ì—°ì† ì†ì‹¤ì´ 20íšŒ ì´ˆê³¼ â†’ í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ/ì†ì ˆ ì „ëµ ì ê²€ í•„ìš”");
        }
        if(expectancy > 0 && expectancy < 0.5){
          recommendations.push("ê¸°ëŒ€ê°’ì´ 0.5% ë¯¸ë§Œ â†’ ì „ëµ ê°œì„  í•„ìš”");
        }
        if(recommendations.length === 0){
          recommendations.push("ëª¨ë“  ì£¼ìš” ë¦¬ìŠ¤í¬/ìˆ˜ìµ ì§€í‘œê°€ ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ì¬ ì „ëµì„ ìœ ì§€í•˜ê±°ë‚˜, ì¶”ê°€ ê°œì„ ì„ ì‹œë„í•´ë³´ì„¸ìš”.");
        }
        html += `<br/><b>ì¶”ì²œì‚¬í•­</b><ul style="margin-top:0.3em;">` + recommendations.map(r=>`<li>${r}</li>`).join('') + `</ul>`;
        return html;
      }
      function formatMetricVerticalTables(summary, config) {
        // ë³´ì—¬ì¤„ í†µê³„ê°’ ì¢…ë¥˜
        const stat_keys = [
          {key: 'Median', label: 'ì¤‘ì•™ê°’'},
          {key: 'Mean', label: 'í‰ê· '},
          {key: 'Min', label: 'ìµœì†Œ'},
          {key: 'Max', label: 'ìµœëŒ€'},
          {key: '90%tile', label: '90%'}
        ];
        const metrics = Object.keys(summary);
        // ì²« ë‘ ì§€í‘œ: ì´ˆê¸° ìë³¸, ë² íŒ… ê¸ˆì•¡
        const metric_labels = [
          {label: '<b>ì´ˆê¸° ìë³¸</b>', get: ()=>formatNum(config.initial_capital,0)},
          {label: '<b>ë² íŒ… ê¸ˆì•¡</b>', get: ()=>formatNum(config.bet_size,0)}
        ];
        // ë‚˜ë¨¸ì§€ ì§€í‘œ
        for(const metric of metrics) {
          const isPct = metric.includes('%');
          metric_labels.push({
            label: metricsMap[metric],
            get: (statKey)=>isPct ? formatPct(summary[metric][statKey]) : formatNum(summary[metric][statKey])
          });
        }
        // ê° í†µê³„ê°’ë³„ë¡œ í‘œ ìƒì„± (wrapperë¡œ ê°ì‹¸ê¸°)
        return stat_keys.map(stat => {
          let rows = metric_labels.map(m =>
            `<tr><td class="metric">${m.label}</td><td>${m.get(stat.key)}</td></tr>`
          ).join('');
          return `<div class="stats-vertical-table-wrapper"><table class="stats-vertical-table"><thead><tr><th>ì§€í‘œëª…</th><th>${stat.label}</th></tr></thead><tbody>${rows}</tbody></table></div>`;
        }).join('');
      }
      const results = await montecarloSimulation(cfg, showProgress);
      hideProgress();
      const summary = summarizeMontecarloResults(results, METRICS);
      let html = '<h2>ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</h2>';
      html += formatMetricTable(summary, cfg);
      html += formatMetricVerticalTables(summary, cfg);
      html += analyzeStrategy(summary, cfg);
      // ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ í‘œ ì•„ë˜ìª½ì— ì§€í‘œ ì„¤ëª… ë°•ìŠ¤ ì¶”ê°€
      const indicatorDescriptions = `
<div class="indicator-explain-box" style="background:#f8fafd; border:1px solid #dbeafe; border-radius:8px; margin-top:2.5em; padding:1.2em 1.5em; font-size:1.03em; color:#234;">
  <b>ğŸ“Š ì‹œë®¬ë ˆì´ì…˜ ì£¼ìš” ì§€í‘œ í•´ì„¤</b><br><br>
  <b>ì´ˆê¸° ìë³¸</b>: ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ì‹œì ì˜ ìë³¸ê¸ˆ(ì›í™” ê¸°ì¤€).<br>
  <b>ë² íŒ… ê¸ˆì•¡</b>: ê° ê±°ë˜(ë² íŒ…)ë§ˆë‹¤ íˆ¬ìí•˜ëŠ” ê¸ˆì•¡.<br>
  <b>ì´ ê±°ë˜ìˆ˜</b>: ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì‹¤ì œë¡œ ì‹¤í–‰ëœ ê±°ë˜(ë² íŒ…) íšŸìˆ˜.<br>
  <b>ìµœëŒ€ ë‚™í­(%)</b>: ì‹œë®¬ë ˆì´ì…˜ ì¤‘ ìë³¸ì´ ìµœê³ ì  ëŒ€ë¹„ ì–¼ë§ˆë‚˜ í¬ê²Œ í•˜ë½í–ˆëŠ”ì§€ì˜ ìµœëŒ€ì¹˜(ìŒìˆ˜, ì ˆëŒ€ê°’ì´ í´ìˆ˜ë¡ ìœ„í—˜).<br>
  <b>ìµœëŒ€ ì—°íŒ¨</b>: ì—°ì†ìœ¼ë¡œ ì†ì‹¤(íŒ¨ë°°)ì´ ë°œìƒí•œ ìµœëŒ€ íšŸìˆ˜(ë©˜íƒˆÂ·ìê¸ˆ ê´€ë¦¬ì— ë§¤ìš° ì¤‘ìš”).<br>
  <b>ìˆ˜ìµ íŒ©í„°</b>: ì´ ìˆ˜ìµ Ã· ì´ ì†ì‹¤. 1.0 ì´ìƒì´ë©´ ìˆ˜ìµ êµ¬ì¡°, 1.5~2.0 ì´ìƒì´ë©´ ìš°ìˆ˜.<br>
  <b>íšŒë³µ íŒ©í„°</b>: ì´ ìˆ˜ìµ Ã· ìµœëŒ€ ë‚™í­. ë‚™í­(ë¦¬ìŠ¤í¬) ëŒ€ë¹„ ìˆ˜ìµì˜ íš¨ìœ¨ì„±. ë†’ì„ìˆ˜ë¡ ì•ˆì •ì .<br>
  <b>ê¸°ëŒ€ ìˆ˜ìµë¥ (%)</b>: ê±°ë˜ 1íšŒë‹¹ í‰ê· ì ìœ¼ë¡œ ê¸°ëŒ€í•  ìˆ˜ ìˆëŠ” ìˆ˜ìµë¥ (ì‹¤ì œ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ê¸°ë°˜).<br>
  <b>ìë³¸ê¸ˆ ë³€í™”ìœ¨(%)</b>: ì‹œë®¬ë ˆì´ì…˜ ì¢…ë£Œ ì‹œì ì˜ ìë³¸ì´ ì‹œì‘ ëŒ€ë¹„ ì–¼ë§ˆë‚˜ ë³€í–ˆëŠ”ì§€(%)<br>
  <b>ìµœì¢… ìë³¸ê¸ˆ</b>: ì‹œë®¬ë ˆì´ì…˜ ì¢…ë£Œ í›„ ë‚¨ì€ ìë³¸ê¸ˆ(ì›í™” ê¸°ì¤€).<br>
  <br>
  <span style="color:#2b72ff;">â€» ê° ì§€í‘œëŠ” ì „ëµì˜ ìˆ˜ìµì„±, ìœ„í—˜, ì•ˆì •ì„±, ì‹¤ì „ ì ìš© ê°€ëŠ¥ì„±ì„ ì¢…í•©ì ìœ¼ë¡œ íŒë‹¨í•˜ëŠ” ë° í™œìš©ë©ë‹ˆë‹¤.</span>
</div>
<!-- ì¤‘ì•™ê°’/90%/99% êµ¬ê°„ í•´ì„ë²• ì•ˆë‚´ ì¶”ê°€ -->
<div style="border:1px solid #ddd; border-radius:8px; background:#f9f9f9; padding:18px; margin-top:24px; font-size:1em; line-height:1.7;">
  <b>ğŸ“Š ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ í•´ì„ë²• ì•ˆë‚´</b><br><br>
  <b>ì¤‘ì•™ê°’(50%)</b> : ì „ì²´ ì‹œë®¬ë ˆì´ì…˜ ì¤‘ ì ˆë°˜ì´ ì´ ê°’ë³´ë‹¤ ì¢‹ê³ , ì ˆë°˜ì´ ë‚˜ì©ë‹ˆë‹¤.<br>
  ì¦‰, â€œí‰ê· ì ì¸ ìƒí™©â€ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.<br><br>
  <b>90% / 95% / 99% ê°’</b> : ê°ê° 10ë²ˆ, 20ë²ˆ, 100ë²ˆ ì¤‘ 9ë²ˆ, 19ë²ˆ, 99ë²ˆì€ ì´ ê°’ ì´ìƒì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
  ì¦‰, â€œìš´ì´ ë‚˜ìœ ê²½ìš°â€ê¹Œì§€ ê°ì•ˆí•œ ë³´ìˆ˜ì ì¸ ê¸°ì¤€ì…ë‹ˆë‹¤.<br><br>
  <b>ì‹¤ì „ì—ì„œëŠ”?</b><br>
  ì¤‘ì•™ê°’ì€ ì°¸ê³ ë§Œ í•˜ê³ , <b>90%~99% ê°’</b>ì„ â€œìµœì•…ì˜ ê²½ìš° ë‚´ê°€ ê°ë‹¹í•  ìˆ˜ ìˆëŠ” ì†ì‹¤/ì„±ê³¼â€ì˜ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.<br>
  (ì˜ˆ: 99% êµ¬ê°„ì˜ ìµœëŒ€ ë‚™í­, ìµœì¢… ìë³¸ê¸ˆ ë“±)<br><br>
  <b>ì™œ ì´ë ‡ê²Œ ë³´ë‚˜ìš”?</b><br>
  ì‹œë®¬ë ˆì´ì…˜ì€ ê·¹ë‹¨ì ìœ¼ë¡œ ìš´ì´ ë‚˜ìœ(ë¸”ë™ìŠ¤ì™„) ê²½ìš°ë„ í¬í•¨í•©ë‹ˆë‹¤.<br>
  ìµœì†Œê°’ì€ í˜„ì‹¤ì—ì„œ ê±°ì˜ ë‚˜ì˜¤ì§€ ì•ŠëŠ” ê·¹ë‹¨ê°’ì´ë¯€ë¡œ, <b>ì‹¤ì „ ì „ëµ/ìê¸ˆ ê´€ë¦¬ëŠ” 90~99% êµ¬ê°„ì„ ê¸°ì¤€</b>ìœ¼ë¡œ ì„¸ìš°ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.<br><br>
  <b>ğŸ“ ì‹¤ì „ íŒ</b><br>
  - â€œ99% êµ¬ê°„ì˜ ìµœëŒ€ ë‚™í­â€ì„ ê²¬ë”œ ìˆ˜ ìˆëŠ” ìê¸ˆë§Œ íˆ¬ìí•˜ì„¸ìš”.<br>
  - â€œì¤‘ì•™ê°’â€ì€ ì°¸ê³ ë§Œ, â€œ90~99% êµ¬ê°„â€ì„ ì‹¤ì „ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìœ¼ì„¸ìš”.
</div>
`;
      html += indicatorDescriptions;
      document.getElementById('result').innerHTML = html;
      document.getElementById('run-btn').disabled=false;
      window.scrollTo({top:document.getElementById('result').offsetTop-40, behavior:'smooth'});
    });
    // Live output for sliders
    document.getElementById('win_prob').addEventListener('input',function(){ winProbOut.value=this.value; });
    document.getElementById('cluster_coeff').addEventListener('input',function(){ clusterCoeffOut.value=this.value; });
    // Disable black swan probability/loss if unchecked
    document.getElementById('enable_black_swan').addEventListener('change',function(){
      document.getElementById('black_swan_prob').disabled = !this.checked;
      document.getElementById('black_swan_loss_pct').disabled = !this.checked;
      document.getElementById('black_swan_prob').style.background = this.checked?'':'#eee';
      document.getElementById('black_swan_loss_pct').style.background = this.checked?'':'#eee';
    });
    // Init
    if(!document.getElementById('enable_black_swan').checked){
      document.getElementById('black_swan_prob').disabled = true;
      document.getElementById('black_swan_loss_pct').disabled = true;
    }
    // ì•„ì½”ë””ì–¸ ë™ì‘ ì´ë²¤íŠ¸ ë°”ì¸ë”©
    setTimeout(()=>{
      if(window.innerWidth<=600){
        document.querySelectorAll('.accordion-title').forEach(title=>{
          title.onclick = function(){
            const item = this.parentElement;
            if(item.classList.contains('open')){
              item.classList.remove('open');
            }else{
              document.querySelectorAll('.accordion-item').forEach(i=>i.classList.remove('open'));
              item.classList.add('open');
            }
          };
        });
      }
    }, 100);
  </script>
</body>
</html>